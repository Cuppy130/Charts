<ActorFrame><children>

	<Layer
		Type="Quad"
		InitCommand="hidden,1"
		OnCommand="sleep,117 + (60 / 188 * 8)"
	/>
	
	<Layer
		Type="Quad"
		InitCommand="hidden,1"
		OnCommand="%function(self)
				fgcurcommand = 1;
				checked = false;
				prefix_time = 0;
				prefix_inc = 0;
				
				prefix_curmessage = 1;
				
				
				prefix_messages = {
					{68.674,'WhiteFlash'},
					{68.674,'LetterboxOn'},
				};
				
				
				prefix_mods = {
				
				{0,200,'1.5x,-999999% Cover,*10000 No Beat','end'},
				
				{11.489,18.351,'*0.1458 Mini,*0.2186 150% Distant','end'},
				
				{8.457,240/188/4,'*1.5667 50% Stealth','len'},
				{8.457+240/188/4,240/188/4*7,'*0.2239 Stealth','len'},
				
				{11.011,240/188/4,'*1.5667 50% Stealth','len'},
				{11.011+240/188/4,240/188/4*3,'*0.5223 Stealth','len'},
				
				{12.287,240/188/4,'*1.5667 50% Stealth','len'},
				{12.287+240/188/4,240/188/4*3,'*0.5223 Stealth','len'},
				
				{13.564,240/188/4,'*1.5667 50% Stealth','len'},
				{13.564+240/188/4,240/188/4,'*1.5667 Stealth','len'},
				
				{14.202,240/188/4,'*1.5667 50% Stealth','len'},
				{14.202+240/188/4,240/188/4,'*1.5667 Stealth','len'},
				
				{14.840,240/188/4,'*1.5667 50% Stealth','len'},
				{14.840+240/188/4,240/188/4*3,'*0.5223 Stealth','len'},
				
				{16.117,240/188/4,'*1.5667 50% Stealth','len'},
				{16.117+240/188/4,240/188/4*3,'*0.5223 Stealth','len'},
				
				{17.394,240/188/4,'*1.5667 50% Stealth','len'},
				{17.394+240/188/4,240/188/2,'*0.7834 Stealth','len'},
				
				{18.351,240/188/8*5,'*1.2534 No Stealth,*1.2534 No Mini,*1.88 No Distant','len'},
				
				{18.989,240/188/4,'*10000 1000% Beat','len'},
				
				{19.149,39.574,'*10000 -500% Reverse,*10000 91% Centered,*10000 0.135x','end'},
				{19.149,38.298,'*15.6667 -2000% Bumpy,*0.7834 Distant,*0.3917 50% Mini, *100 2000 sudden, -75 suddenoffset','end'},
				{38.298,240/188,'*15.6667 No Bumpy,*0.7834 No Distant,*0.3917 No Mini, *100 no sudden','len'},
				
				{39.415,240/188/4,'*10000 1000% Beat','len'},
				{39.574,60.000,'*10000 No Reverse,*10000 No Centered,*10000 0.05x,*10000 C5640','end'},
				
				{39.574,57.766,'*3.1334 Drunk','end'},
				
				{57.766,60.000,'*0.4477 No Drunk','end'},
				
				{59.840,240/188/4,'*10000 1000% Beat','len'},
				{60.000,240/188/16,'*10000 1.5x,*10000 C188','len'},
				
				{60.000,240/188*6,'*0.7834 600% Reverse','len'},
				
				{67.660,240/188/4,'*10000 No Reverse','len'},
				
				{68.777,200,'*0.0461 -12.5% Flip','end'},
				
				{68.777,240/188/8*20,'*0.3687 Stealth','len'},
				
				{71.968,240/188/8*5,'*1.2534 No Stealth','len',1},
				{71.968,200,'*0.6267 50% Stealth','end',2},
				
				{72.606,240/188/4,'*10000 1000% Beat','len'},
				
				{92.713,110.585,'*1.5667 50% Tipsy,*1.5667 50% Wave,*0.7834 25% Drunk','end',1},
				{92.713,110.585,'*1.5667 50% Tipsy,*1.5667 -50% Wave,*0.7834 25% Drunk','end',2},
				
				{110.585,240/188/8*3,'*1.0445 No Tipsy,*1.0445 No Wave,*0.5223 No Drunk','len'},
				
				{110.106,240/188/8*10,'*1.0445 Dark','len'},
				
				{111.383,240/188/4*3,'*10000 Stealth','len'},
				{111.383,240/188/4,'*10000 -150% Centered','len'},
				
				{111.702,200,'*0.7834 300% Centered,*10000 1x,*10000 C100.2752','end'},
				
				{112.340,240/188,'*0.7834 No Stealth','len',1},
				{112.340,240/188,'*0.3917 No Stealth','len',2},
				
				
				}
				
				for i = 39.574,57.765,240/188/4 do
					table.insert(prefix_mods,{i,240/188/8,'*188 3000% Wave','len'});
					table.insert(prefix_mods,{i+240/188/8,240/150/8,'*188 No Wave','len'});
				end
				
				prefix_plr = {};
				
				self:queuecommand('Update');
			end"
		
		UpdateCommand="%function(self)
		
			local beat = GAMESTATE:GetSongBeat();
			
			-----------------------
			-- Player mod resets --
			-----------------------
			GAMESTATE:ApplyGameCommand('mod,clearall')
			prefix_inc = prefix_inc + 1;
			
			--------------------------------------------------------------------------------------------
			-- Mod reader code originally coded by Taronuke, remade to support end times and lengths. --
			--------------------------------------------------------------------------------------------
			for i,v in pairs(prefix_mods) do
				if prefix_time >=v[1] then
					if (v[4] == 'len' and prefix_time <=v[1]+v[2]) or (v[4] == 'end' and prefix_time <=v[2]) then
						if table.getn(v) == 5 then
							GAMESTATE:ApplyGameCommand('mod,'..v[3],v[5]);
						else
							GAMESTATE:ApplyGameCommand('mod,'..v[3]);
						end
					end
				end
			end
			
			
			
			if beat >= 0 and not checked then
				
				table.insert(prefix_plr,SCREENMAN:GetTopScreen():GetChild('PlayerP1'));
				table.insert(prefix_plr,SCREENMAN:GetTopScreen():GetChild('PlayerP2'));
				checked = true;
				
				SCREENMAN:GetTopScreen():GetChild('Overlay'):hidden(1);
				SCREENMAN:GetTopScreen():GetChild('Underlay'):hidden(1);
				for i,v in pairs(prefix_plr) do
					if v then
						SCREENMAN:GetTopScreen():GetChild('ScoreP'..i):hidden(1);
						SCREENMAN:GetTopScreen():GetChild('LifeP'..i):hidden(1);
						local d = SCREEN_CENTER_X-160
						if i == 2 then d = SCREEN_CENTER_X+160 end
						v:x(d);
					end
				end
			end
			
			
			-------------------------
			-- BEAT SPECIFIC STUFF --
			-------------------------
			if beat >= 215.5 and beat < 228 then
				for i,v in pairs(prefix_plr) do
					local multi = 0; if math.mod(prefix_inc,2) == 0 then multi = 1; end
					local multi2 = -1; if i == 2 then multi2 = 1; end
					if v then
						v:x(SCREEN_CENTER_X+multi2*160+multi*640)
					end
				end
			end
			
			if beat >= 228 and beat < 372 then
				for i,v in pairs(prefix_plr) do
					local multi = 0; if math.mod(prefix_inc,2) == 0 then multi = 1; end
					local multi2 = -1; if i == 2 then multi2 = 1; end
					if v then
						v:x(math.mod((SCREEN_CENTER_X+multi2*160+multi*640+beat*40),1280)+(SCREEN_CENTER_X-480))
					end
				end
			end
			
			--------------------------------------------------------------
			-- Message reader to make specific values of the actor aux. --
			--------------------------------------------------------------
			if prefix_curmessage <= table.getn(prefix_messages) then
				if prefix_time >= prefix_messages[prefix_curmessage][1] then
					MESSAGEMAN:Broadcast(prefix_messages[prefix_curmessage][2]);
					prefix_curmessage = prefix_curmessage + 1;
				end
			end
			
			self:queuecommand('Update2');
			
		end"


		Update2Command="%function(self)
		self:sleep(0.02);
		self:queuecommand('Update');
		end"

	/>
	
	<Layer Type="Quad" OnCommand="zoomto,SCREEN_WIDTH,SCREEN_HEIGHT;horizalign,right;x,SCREEN_CENTER_X-320;y,SCREEN_CENTER_Y;diffuse,0,0,0,1;hidden,1"
	LetterboxOnMessageCommand="hidden,0" />
	<Layer Type="Quad" OnCommand="zoomto,SCREEN_WIDTH,SCREEN_HEIGHT;horizalign,left;x,SCREEN_CENTER_X+320;y,SCREEN_CENTER_Y;diffuse,0,0,0,1;hidden,1"
	LetterboxOnMessageCommand="hidden,0" />
	<Layer Type="Quad" OnCommand="stretchto,0,0,SCREEN_WIDTH,SCREEN_HEIGHT;diffuse,1,1,1,0;"
	WhiteFlashMessageCommand="diffusealpha,1;linear,1;diffusealpha,0;" />
	
	<BitmapText
		Font="Common Normal"
		Text="test"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;effectclock,music;playcommand,SetTime;hidden,1"
		SetTimeCommand="%function(self) self:settext(self:GetSecsIntoEffect()); prefix_time = PREFSMAN:GetPreference('GlobalOffsetSeconds') - (0.012 - 0.485) + tonumber(self:GetText()); self:sleep(0.02); self:queuecommand('SetTime'); end"
	/>
	
	<!-- Aux actor, VERY IMPORTANT -->
	<Layer
		Type="Quad"
		OnCommand=""
		InitCommand="%function(self) auxvar = self; self:hidden(1) end"
		SkewTwitchMessageCommand="finishtweening;aux,0;linear,9.6;aux,1.5;linear,1.6;aux,0"
	/>
	
</children></ActorFrame>