 <ActorFrame InitCommand="%function(self)
 
	if FUCK_EXE then
 
		songName = GAMESTATE:GetCurrentSong():GetSongDir();
		sw,sh=SCREEN_WIDTH,SCREEN_HEIGHT
		dw,dh=DISPLAY:GetDisplayWidth(),DISPLAY:GetDisplayHeight() 
		scx,scy=SCREEN_CENTER_X,SCREEN_CENTER_Y
		mod_bgafts = {}
		
		function poly_npot(val)
			local out = 2
			while out < val do
				out = out*2
			end
			return out
		end
	
	end
	
end"
><children>

	<Layer Type="ActorFrame" Condition="FUCK_EXE" ><children>
	
		<Layer Type="ActorFrame" Var="c9_night_stuff" OnCommand="hidden,1"><children>
			<Layer File="night" OnCommand="stretchto,0,0,sw,sh" />
			<Layer File="stars" OnCommand="zoom,4;customtexturerect,0,0,4,4;texcoordvelocity,.04,.04;blend,add;diffusealpha,.4;fadebottom,.3;" />

			<Layer
				Type="ActorFrameTexture" 
				Var="c9_night_aft" 
				OnCommand="%function(self) 
					self:hidden(1)
					self:SetWidth(DISPLAY:GetDisplayWidth())
					self:SetHeight(DISPLAY:GetDisplayHeight())
					self:EnableDepthBuffer(true)
					self:EnableAlphaBuffer(true)
					self:EnableFloat(false)
					self:EnablePreserveTexture(true)
					self:Create()
					table.insert(mod_bgafts,self) 
				end"
			/>
		</children></Layer>
		
		<Layer Type="Quad" Var="c9_bgQuad" InitCommand="hidden,0;zoomto,sw,sh;xy,scx,scy;diffuse,0/255,0/255,0/255,1;" />

		<Layer 
			Type="ActorFrame" 
			Var="c9_polygrid_frame" 
			OnCommand="xy,scx,scy;fov,60;playcommand,Dist" 
			DistCommand="%function(self) self:SetFarDist(100000) end">
		<children>
		<Layer
			Type="Polygon"
			DrawMode="Quads"
			Var="c9_polygrid"
			InitCommand="xy,-scx,-scy;hidden,0;zoomz,100;rotationx,0;queuecommand,Set;"
			SetCommand="%function(self)
				local size = c9_polygrid_size
				self:zoomto( (sw/size) , (sh/size) )
				self:SetNumVertices(4*(size^2))
				self:SetPolygonMode(0)
				self:SetLineWidth(2)

				for i = 0,(size^2)-1 do
					local x = math.mod(i,size)
					local y = math.floor(i/size)
					local cur_square = (i*4)

					self:SetVertexPosition(cur_square,x,y,0)
					self:SetVertexPosition(cur_square+1,x+1,y,0)
					self:SetVertexPosition(cur_square+2,x+1,y+1,0)
					self:SetVertexPosition(cur_square+3,x,y+1,0)

					for c = 0,3 do
						self:SetVertexColor(cur_square+c,x/size,y/size,y/size,0)
					end

				end
			end"
		/>
		</children></Layer>

		<Layer Type="ActorFrame" Var="c9_dither_frame" OnCommand="hidden,1;"><children>
			<Layer
				Type="ActorFrameTexture" 
				Var="c9_dither_aft" 
				OnCommand="%function(self) 
					self:hidden(1)
					self:SetWidth(DISPLAY:GetDisplayWidth())
					self:SetHeight(DISPLAY:GetDisplayHeight())
					self:EnableDepthBuffer(true)
					self:EnableAlphaBuffer(true)
					self:EnableFloat(false)
					self:EnablePreserveTexture(true)
					self:Create()
					table.insert(mod_bgafts,self) 
				end"
			/>
			<Layer 
				Type="Sprite" 
				Texture="white.png"
				Frag="shaders/dither.frag"
				Var="c9_dither"
				OnCommand="hidden,1;xy,scx,scy;basezoomx,sw/dw;basezoomy,-(sh/dh);zoom,1;diffusealpha,1;sleep,0.1;queuecommand,Render;"
				RenderCommand="%function(self)
					self:SetTexture(c9_dither_aft:GetTexture())
					self:hidden(0)
				end"
			/>
			<Layer
				File="shaders/bayer.png"
				Var="c9_bayer"
				InitCommand="hidden,1;"
				OnCommand="%function(self)
					c9_dither:GetShader():uniformTexture('bayer',self:GetTexture())
				end"
			/>
		</children></Layer>

		<Layer Type="ActorFrame" Var="c9_woah_frame" OnCommand="hidden,1;"><children>
			<Layer
				Type="ActorFrameTexture" 
				Var="c9_woah_aft" 
				OnCommand="%function(self) 
					self:hidden(1)
					self:SetWidth(DISPLAY:GetDisplayWidth())
					self:SetHeight(DISPLAY:GetDisplayHeight())
					self:EnableDepthBuffer(true)
					self:EnableAlphaBuffer(true)
					self:EnableFloat(false)
					self:EnablePreserveTexture(true)
					self:Create()
					table.insert(mod_bgafts,self) 
				end"
			/>
			
			
			
		</children></Layer>
		
		<!--taro-->
		
		<Layer Type="Quad" InitCommand="hidden,0;zoomto,sw,sh;xy,scx,scy;diffuse,0/255,0/255,0/255,1;" />
		
		<Layer File="gradient1.png" Var="c9_gradient" InitCommand="hidden,1;zoomto,sw,sh;xy,scx,scy;" />
		<Layer File="bg.png" Var="c9_itg" InitCommand="hidden,0;zoomto,sw,sh;xy,scx,scy;" />
		
		<CODE Type="Quad"
		InitCommand="%function(self)
		
			c9_taro_numtiles = 8
			
			function set_tile_size( obj, tilex, tiley, size, aft )
			
				local numtiles = c9_taro_numtiles
			
				local xp1 = math.floor(sw*((tilex+0.5 - size/2)/numtiles))
				local xp2 = math.floor(sw*((tilex+0.5 + size/2)/numtiles))
				
				local yp1 = math.floor(sh*((tiley+0.5 - size/2)/numtiles))
				local yp2 = math.floor(sh*((tiley+0.5 + size/2)/numtiles))
				
				local txp1 = xp1/sw
				local txp2 = xp2/sw
				local typ1 = yp1/sh
				local typ2 = yp2/sh
				
				if aft then
					txp1 = txp1*(dw/poly_npot(dw))
					txp2 = txp2*(dw/poly_npot(dw))
					typ1 = typ1*(dh/poly_npot(dh))
					typ2 = typ2*(dh/poly_npot(dh))
				end
				
				obj:SetVertexPosition(0+4*tiley+(4*numtiles*tilex),xp1,yp1,0)
				obj:SetVertexPosition(1+4*tiley+(4*numtiles*tilex),xp2,yp1,0)
				obj:SetVertexPosition(2+4*tiley+(4*numtiles*tilex),xp2,yp2,0)
				obj:SetVertexPosition(3+4*tiley+(4*numtiles*tilex),xp1,yp2,0)
						
				obj:SetVertexTexCoord(0+4*tiley+(4*numtiles*tilex),txp1,typ1)
				obj:SetVertexTexCoord(1+4*tiley+(4*numtiles*tilex),txp2,typ1)
				obj:SetVertexTexCoord(2+4*tiley+(4*numtiles*tilex),txp2,typ2)
				obj:SetVertexTexCoord(3+4*tiley+(4*numtiles*tilex),txp1,typ2)
				
			end
			
		end"
		/>
		
		<Layer File="gradient1.png" Var="c9_taro_quad" OnCommand="stretchto,0,0,sw,sh;diffusealpha,0;" />
		
		<Layer File="kiyo1" Var="c9_kiyo1" OnCommand="xy,scx,scy+30;cropbottom,.2;fadebottom,.1;zoom,.7;diffusealpha,0;vibrate;effectmagnitude,1,1,0;" />
		<Layer File="kiyo2" Var="c9_kiyo2" OnCommand="xy,scx,scy+60;cropbottom,.2;fadebottom,.1;zoom,.7;diffusealpha,0;vibrate;effectmagnitude,1,1,0;" />
		
		<Layer Type="ActorFrame" Var="c9_taro_poly_frame" OnCommand="%function(self) self:SetDrawByZPosition(true) end" ><children>
			<Layer Type="Polygon" Texture="bg.png" Frag="shaders/cloud.frag" DrawMode="quads" Var="c9_taro_polygon1" HideCommand="hidden,1;" OnCommand="diffuse,.6,.6,.6,1;xy,0,0;queuecommand,Make"
				MakeCommand="%function(self)
				
					local numtiles = c9_taro_numtiles
					
					self:SetNumVertices(4*numtiles*numtiles)
					self:GetShader():uniform1f('speed',-.015)
					
				end"
			/>
			<Layer Type="Polygon" Texture="bg.png" Frag="shaders/cloud.frag" DrawMode="quads" Var="c9_taro_polygon2" HideCommand="hidden,1;" OnCommand="diffuse,.6,.6,.6,1;xy,0,0;queuecommand,Make"
				MakeCommand="%function(self)
				
					local numtiles = c9_taro_numtiles
					
					self:SetNumVertices(4*numtiles*numtiles)
					
					self:GetShader():uniform3f('skycolour1',107/255,104/255,191/255)
					self:GetShader():uniform3f('skycolour2',254/255,196/255,193/255)
					self:GetShader():uniform1f('speed',.02)
					
				end"
			/>
			<Layer Type="Polygon" Texture="bg.png" Frag="shaders/cloud.frag" DrawMode="quads" Var="c9_taro_polygon3" HideCommand="hidden,1;" OnCommand="diffuse,.6,.6,.6,1;xy,0,0;queuecommand,Make"
				MakeCommand="%function(self)
				
					local numtiles = c9_taro_numtiles
					
					self:SetNumVertices(4*numtiles*numtiles)
					
					self:GetShader():uniform3f('skycolour1',253/255,179/255,.73/255)
					self:GetShader():uniform3f('skycolour2',.8,.4,0)
					self:GetShader():uniform1f('speed',-.02)
					
				end"
			/>
			<Layer Type="Polygon" Texture="bg.png" DrawMode="quads" Var="c9_taro_polygon4" HideCommand="hidden,1;" OnCommand="basezoomy,-1;diffuse,.8,.8,.8,1;xy,0,sh;queuecommand,Make"
				MakeCommand="%function(self)
				
					self:SetTexture(c9_night_aft:GetTexture())
				
					local numtiles = c9_taro_numtiles
					
					self:SetNumVertices(4*numtiles*numtiles)
					
				end"
			/>
			
			<Layer Type="Polygon" Texture="bg.png" Frag="shaders/cloud.frag" DrawMode="quads" Var="c9_taro_polygon5" HideCommand="hidden,1;" OnCommand="diffuse,.6,.6,.6,1;xy,0,0;queuecommand,Make"
				MakeCommand="%function(self)
				
					local numtiles = c9_taro_numtiles
					
					self:SetNumVertices(4*numtiles*numtiles)
					
					self:GetShader():uniform3f('skycolour1',.6,.6,.6)
					self:GetShader():uniform3f('skycolour2',255/255,255/255,153/255)
					self:GetShader():uniform1f('speed',-.017)
					
				end"
			/>		
			
		</children></Layer>

			<Layer 
				Type="Sprite" 
				Texture="white.png"
				Frag="shaders/woah.frag" 
				Var="c9_woah"
				OnCommand="hidden,1;xy,scx,scy;blend,add;basezoomx,sw/dw;basezoomy,-(sh/dh);zoom,1;diffusealpha,1;sleep,0.1;queuecommand,Render;"
				RenderCommand="%function(self)
					self:SetTexture(c9_woah_aft:GetTexture())
				end"
			/>
			
		<Layer File="chara" />

		<Layer Type="ActorFrame" Var="c9_firefly_frame" OnCommand="hidden,1;"><children>
			<Layer
				Type="ActorFrameTexture" 
				Var="c9_firefly_aft" 
				OnCommand="%function(self) 
					self:hidden(1)
					self:SetWidth(DISPLAY:GetDisplayWidth())
					self:SetHeight(DISPLAY:GetDisplayHeight())
					self:EnableDepthBuffer(true)
					self:EnableAlphaBuffer(true)
					self:EnableFloat(false)
					self:EnablePreserveTexture(true)
					self:Create()
					table.insert(mod_bgafts,self) 
				end"
			/>

			<Layer 
				Type="Sprite" 
				Texture="white.png"
				Frag="shaders/firefly.frag" 
				Var="c9_firefly"
				OnCommand="hidden,1;xy,scx,scy;basezoomx,sw/dw;basezoomy,-(sh/dh);zoom,1;diffuse,207/255,229/255,237/255,095;sleep,0.1;queuecommand,Render;"
				RenderCommand="%function(self)
					self:SetTexture(c9_firefly_aft:GetTexture())
					self:hidden(1)
					self:blend('add')
				end"
			/>
		</children></Layer>
		
		
		
		
		
		
		
		
		
		
		
		<ZLayer Type="Quad" OnCommand="stretchto,0,0,sw,sh;diffuse,1,0,0,0" RedOutMessageCommand="diffuse,1,0,0,1;linear,.5;diffuse,0,0,0,1" />


	</children></Layer>

</children></ActorFrame>