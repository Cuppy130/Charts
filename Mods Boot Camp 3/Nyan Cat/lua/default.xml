<ActorFrame
InitCommand="%function(self)

	songName = GAMESTATE:GetCurrentSong():GetSongDir();
	
	sw = SCREEN_WIDTH
	sh = SCREEN_HEIGHT --shortcuts
	
	function Plr(pn)
		return _G['P'..pn]
	end
	function GetJud(pn)
		return _G['jud'..pn]
	end
	function GetCom(pn)
		return _G['com'..pn]
	end
	
	function mod_do(str,pn)
		if pn then
			GAMESTATE:ApplyGameCommand('mod,'..str,pn)
		else
			GAMESTATE:ApplyGameCommand('mod,'..str)
		end
	end
	
	function taro_Sound(str)
		local met = GAMESTATE:GetCurrentSong():GetSongDir();
		SOUND:PlayOnce(met..'lua/'..str..'.ogg');
	end
	
	function math.clamp(val,min,max)
		if val > max then return max
		elseif val < min then return min
		else return val end
	end
	
	nyan_greatw = PREFSMAN:GetPreference('JudgeWindowSecondsGreat')/(60/142)
	nyan_hitdelay = 0
	nyan_curhit = 1
	
	nyan_curnote = 1
	nyan_notes = {}
	nyan_nptr = 0
	nyan_totalnotes = 0;
	
	nyan_stars = {}
	nyan_sptr = 1
	nyan_stimer = 0.5;
	nyan_sdelay = 0.125;
	
	nyan_reme1 = {}
	nyan_reme2 = {}
	
	nyan_bite = 1;
	nyan_bit = 1;
	
	nyan_nhits = {}
	nyan_nhptr = 1
	
	function nyan_make_nhit(obj)
		table.insert(nyan_nhits,obj)
	end
	
	function nyan_get_nhit()
		local a = nyan_nhits[nyan_nhptr]
		nyan_nhptr = math.mod(nyan_nhptr+1,table.getn(nyan_nhits))+1
		return a
	end
	
	nyan_rt = {}
	nyan_rptr = 1
	nyan_rdelay = .1
	nyan_rtimer = 0.5
	
	function nyan_make_trail(obj)
		table.insert(nyan_rt,obj)
	end
	
	function nyan_get_trail()
		local a = nyan_rt[nyan_rptr]
		nyan_rptr = math.mod(nyan_rptr+1,table.getn(nyan_rt))+1
		return a
	end
	
	nyan_ndeds = {}
	nyan_ndptr = 1
	
	function nyan_make_nded(obj)
		table.insert(nyan_ndeds,obj)
	end
	
	function nyan_get_nded()
		local a = nyan_ndeds[nyan_ndptr]
		nyan_ndptr = math.mod(nyan_ndptr+1,table.getn(nyan_ndeds))+1
		return a
	end
	
	nyan_ndks = {}
	nyan_ndkptr = 1
	
	function nyan_make_ndk(obj)
		table.insert(nyan_ndks,obj)
	end
	
	function nyan_get_ndk()
		local a = nyan_ndks[nyan_ndkptr]
		nyan_ndkptr = math.mod(nyan_ndkptr+1,table.getn(nyan_ndks))+1
		return a
	end
	
	function nyan_make_note(obj)
		nyan_totalnotes = nyan_totalnotes+1
		local tn = nyan_totalnotes
		table.insert(nyan_notes,{actor = obj,beat = -1,active = false, nt = 1, col = 1})
		obj:hidden(1)
	end
	
	function nyan_make_pastry(obj)
		local tn = nyan_totalnotes
		nyan_notes[tn].pastry = obj
		obj:hidden(1)
		obj:animate(0)
		obj:setstate(0)
	end
	function nyan_make_icing(obj)
		local tn = nyan_totalnotes
		nyan_notes[tn].icing = obj
		obj:hidden(1)
		obj:animate(0)
		obj:setstate(0)
	end
	
	function nyan_make_star(obj)
		table.insert(nyan_stars,obj)
	end
	
	function nyan_get_star()
		local a = nyan_stars[nyan_sptr]
		nyan_sptr = math.mod(nyan_sptr+1,table.getn(nyan_stars))+1
		return a
	end
	
	function nyan_make_reme1(obj)
		table.insert(nyan_reme1,obj)
	end
	function nyan_make_reme2(obj)
		table.insert(nyan_reme2,obj)
	end
	
	function nyan_spawn_star(x,y)
		local a = nyan_get_star()
		if a then
			a:x(x)
			a:y(y)
			a:zoom(2)
			a:hidden(0)
			a:setstate(0)
			a:sleep(0.42)
			a:queuecommand('Hide')
		end
	end
	
	nyan_dir = {90,0,180,-90}
	
	function nyan_quantize(obj, b)
		b = b/2;
		local r = b-math.floor(b)
		if r == 0 then nyan_note_color(obj,4)
		elseif r == 0.5 then nyan_note_color(obj,8)
		elseif (r > 0.33 and r < 0.34) or (r > 0.66 and r < 0.67) then nyan_note_color(obj,12)
		elseif r == 0.25 or r == 0.75 then nyan_note_color(obj,16)
		elseif (r > 0.166 and r < 0.167) or (r > 0.83 and r < 0.84) then nyan_note_color(obj,12)
		elseif r == 0.125 or r == 0.375 or r == 0.625 or r == 0.875 then nyan_note_color(obj,32)
		else nyan_note_color(obj,64) end
	end
	
	function nyan_note_color(obj, n)
		if n == 4 then obj:diffuse(1,0.4,0.3,1); end
		if n == 8 then obj:diffuse(0.3,0.7,1,1); end
		if n == 12 then obj:diffuse(1,0.4,1,1); end
		if n == 16 then obj:diffuse(0.3,1,0.4,1); end
		if n == 32 then obj:diffuse(1,0.8,0.3,1); end
		if n == 64 then obj:diffuse(0.3,1,0.7,1); end
	end
	
	slumpo = false
	for pn=1,2 do
		if GAMESTATE:IsPlayerEnabled(pn-1) then
			if GAMESTATE:GetCurrentSteps(pn-1):GetDifficulty() == 5 then
				slumpo = true
			end
		end
	end
	
	note_spacing = 96
	if slumpo then
		note_spacing = 130
	end
	
	--cache positions at certain beats because otherwise this will become cursed
	local x88 = (40*note_spacing) + (0.707*note_spacing*4)*math.sin(((52-40)/8)*math.pi) + (0.707*note_spacing*8) - (0.707*note_spacing*8)*math.cos(((8)/16)*math.pi)
	local y88 = (-0.707*note_spacing*4) + (0.707*note_spacing*4)*math.cos(((52-40)/8)*math.pi) + (80-52)*note_spacing + (0.707*note_spacing*8)*math.sin(((8)/16)*math.pi)
	nyan_at88 = { x = x88, y = y88 }
	nyan_at152 = { x = nyan_at88.x + (120-88)*note_spacing, y = nyan_at88.y }
	
	function nyan_getpos(beat)
		
		local px = beat * note_spacing
		local py = 0
		local pz = 0
		
		if beat < 40 then
			px = beat*note_spacing
		elseif beat >= 40 and beat < 48 then
			px = (40*note_spacing) + (0.707*note_spacing*4)*math.sin(((beat-40)/8)*math.pi)
			py = (-0.707*note_spacing*4) + (0.707*note_spacing*4)*math.cos(((beat-40)/8)*math.pi)
		elseif beat >= 48 and beat < 52 then
			px = (40*note_spacing) + (0.707*note_spacing*4)*math.sin(((beat-40)/8)*math.pi)
			py = (-0.707*note_spacing*4) + (0.707*note_spacing*4)*math.cos(((beat-40)/8)*math.pi)
		elseif beat >= 52 and beat < 80 then
			px = (40*note_spacing) + (0.707*note_spacing*4)*math.sin(((52-40)/8)*math.pi)
			local curry = (-0.707*note_spacing*4) + (0.707*note_spacing*4)*math.cos(((52-40)/8)*math.pi)
			py = curry + (beat-52)*note_spacing
		elseif beat >= 80 and beat < 88 then
			local curry = (-0.707*note_spacing*4) + (0.707*note_spacing*4)*math.cos(((52-40)/8)*math.pi)
			py = curry + (80-52)*note_spacing + (0.707*note_spacing*8)*math.sin(((beat-80)/16)*math.pi)
			local currx = (40*note_spacing) + (0.707*note_spacing*4)*math.sin(((52-40)/8)*math.pi)
			px = currx + (0.707*note_spacing*8) - (0.707*note_spacing*8)*math.cos(((beat-80)/16)*math.pi)
		elseif beat >= 88 and beat < 104 then
			px = nyan_at88.x + (beat-88)*note_spacing
			py = nyan_at88.y
		elseif beat >= 104 and beat < 120 then
			px = nyan_at88.x + (beat-88)*note_spacing
			local amp = (100 + 100*math.clamp((beat-104)/12,0,1))
			py = nyan_at88.y - (amp/2) + (amp/2)*math.cos((beat-104)*math.pi*0.25)
		elseif beat >= 120 and beat < 152 then
			px = nyan_at88.x + (120-88)*note_spacing + (0.707*note_spacing*8)*math.sin(((beat-120)/16)*math.pi)
			py = nyan_at88.y - (0.707*note_spacing*8) + (0.707*note_spacing*8)*math.cos(((beat-120)/16)*math.pi)
		elseif beat >= 152 and beat < 168 then
			px = nyan_at152.x + (beat-152)*note_spacing
			py = nyan_at152.y
		elseif beat >= 168 and beat < 176 then
			px = nyan_at152.x + (168-152)*note_spacing + (0.707*note_spacing*8)*math.sin(((beat-168)/16)*math.pi)
			py = nyan_at152.y - (0.707*note_spacing*8) + (0.707*note_spacing*8)*math.cos(((beat-168)/16)*math.pi)
		elseif beat >= 176 and beat < 208 then
			px = nyan_at152.x + (168-152)*note_spacing + (0.707*note_spacing*8)*math.sin(((176-168)/16)*math.pi)
			py = nyan_at152.y - (0.707*note_spacing*8) + (0.707*note_spacing*8)*math.cos(((176-168)/16)*math.pi) - (beat-176)*note_spacing
		elseif beat >= 208 and beat < 216 then
			px = nyan_at152.x + (168-152)*note_spacing + (0.707*note_spacing*8)*math.sin(((176-168)/16)*math.pi) + (0.707*note_spacing*8) - (0.707*note_spacing*8)*math.cos(((beat-208)/16)*math.pi)
			py = nyan_at152.y - (0.707*note_spacing*8) + (0.707*note_spacing*8)*math.cos(((176-168)/16)*math.pi) - (208-176)*note_spacing - (0.707*note_spacing*8)*math.sin(((beat-208)/16)*math.pi)
		elseif beat >= 216 then
			px = nyan_at152.x + (168-152)*note_spacing + (0.707*note_spacing*8)*math.sin(((176-168)/16)*math.pi) + (0.707*note_spacing*8) - (0.707*note_spacing*8)*math.cos(((216-208)/16)*math.pi) + (beat-216)*note_spacing
			py = nyan_at152.y - (0.707*note_spacing*8) + (0.707*note_spacing*8)*math.cos(((176-168)/16)*math.pi) - (208-176)*note_spacing - (0.707*note_spacing*8)*math.sin(((216-208)/16)*math.pi)
		end
		
		return {x = px, y = py, z = pz}
		
	end
	
	function nyan_getang(beat)
		return math.atan2( (nyan_getpos(beat+0.1)).y - (nyan_getpos(beat)).y, (nyan_getpos(beat+0.1)).x - (nyan_getpos(beat)).x )
	end
	
	function nyan_spawn_note(beat,col,nt,layer)
		if nt ~= 'M' and nt < 100 then
		
			local cn = nyan_nptr+1
			
			local note = nyan_notes[cn]
			
			if note then
			
				note.active = true;
				note.beat = beat
				note.nt = nt
				note.col = col
			
				local a = note.actor
				local b = note.pastry
				local c = note.icing
				
				local x = nyan_getpos(beat).x;
				local y = nyan_getpos(beat).y;
				
				if a and b and c then
					a:hidden(0)
					a:x(x)
					a:y(y)
					a:rotationx(0)
					a:rotationy(0)
					a:rotationz(nyan_dir[col+1] - nyan_world_rotation)
					a:zoom(1)
					
					if beat == 216 and slumpo then
						--Trace('fuck you')
						b:Load(songName..'lua/_arrowkun 6x1.png');
						b:setstate(0)
					elseif nt == 2 then
						b:Load(songName..'lua/dunno1.png');
					elseif nt == 4 then
						b:Load(songName..'lua/dunno2.png');
					else
						--Trace('fuck me?')
						b:Load(songName..'lua/arrow 4x1.png');
						b:setstate(0)
					end
					
					if beat == 216 and slumpo then
						a:aux(5)
					else
						a:aux(0)
					end
					
					if nt ~= 1 or (beat == 216 and slumpo) then
						c:hidden(1)
					else
						c:hidden(0)
					end
					
					if nt ~= 1 then
						a:rotationz(-nyan_world_rotation)
					end
					
					b:hidden(0)
					
					nyan_quantize(c,beat)
				end
			
			end
			
			nyan_nptr = math.mod(nyan_nptr+1,table.getn(nyan_notes))
			
		end
	end
	
	nyan_world_rotation = 0
	
	nyan_beat = 0
	nyan_lean = 0
	nyan_blink = 0
	nyan_stealth = 0
	nyan_tiny = 0
	
	function nyan_arroweffects(note)
	
		--Trace( math.clamp(0.5+1*math.sin((0.5)*math.pi*1),0,1) )
		
		local beat = GAMESTATE:GetSongBeat()
		local a = note.actor
		
		if a then
		
			local targ = note.beat
			local ang = nyan_getang(targ)
			
			local fBeatStrength = nyan_beat;
			local fLeanStrength = nyan_lean;
			
			local alpha = 1
			
			if note.nt == 1 then
				a:rotationz(nyan_dir[note.col+1] - nyan_world_rotation)
			else
				a:rotationz(-nyan_world_rotation)
			end
			
			a:x( nyan_getpos(targ).x )
			a:y( nyan_getpos(targ).y )
			
			
			
			alpha = 1-nyan_stealth
			
			alpha = alpha-((nyan_blink/2)+math.clamp((nyan_blink)*math.cos((beat-targ-0.25)*math.pi*1),-(nyan_blink/2),(nyan_blink/2)))
			
			--alpha handler
			
			if note.actor:getaux() < 5 then
				if alpha < 1 and alpha >= 0.5 then
					note.pastry:diffusealpha(1)
					note.icing:diffusealpha(1)
					note.pastry:glow(1,1,1,2-(alpha*2))
					note.icing:glow(1,1,1,2-(alpha*2))
				elseif alpha < 0.5 and alpha >= 0 then
					note.pastry:diffusealpha(0)
					note.icing:diffusealpha(0)
					note.pastry:glow(1,1,1,alpha*2)
					note.icing:glow(1,1,1,alpha*2)
				elseif alpha < 0 then
					note.pastry:diffusealpha(0)
					note.icing:diffusealpha(0)
					note.pastry:glow(1,1,1,0)
					note.icing:glow(1,1,1,0)
				else
					note.pastry:diffusealpha(1)
					note.icing:diffusealpha(1)
					note.pastry:glow(1,1,1,0)
					note.icing:glow(1,1,1,0)
				end
			end
			
			--make arrowkun get scared
			if note.actor:getaux() == 5 then
				
				if beat > targ-1.5 then
					note.pastry:setstate(3)
				end
				
			end
			
			--lean
			
			if fLeanStrength ~= 0 then
				
				a:addx( math.sin(0.25*math.pi*(beat-targ))*64*fLeanStrength*math.sin(ang) )
				a:addy( -math.sin(0.25*math.pi*(beat-targ))*64*fLeanStrength*math.cos(ang) )
				
			end
			
			--tiny
			
			if nyan_tiny ~= 0 then
				
				a:zoom( 1 - nyan_tiny*0.5 )
				
			end
			
			--beat
			
			if fBeatStrength ~= 0 then
			
				local fBeatStrength = nyan_beat;
				
				local fAccelTime = 0.3;
				local fTotalTime = 0.7;
				
				local fOffset = (targ-beat)*48;

				-- If the song is really fast, slow down the rate, but speed up the
				-- acceleration to compensate or it'll look weird.
				
				local fBPM = 142;
				
				local fBeat = beat + fAccelTime;
				
				local bEvenBeat = false;
				if math.mod(math.floor(fBeat/2),2) == 0 then
					--bEvenBeat = true;
				end
				
				--who wrote this!?

				fBeat = fBeat-math.floor( fBeat );
				fBeat = fBeat+1;
				fBeat = fBeat-math.floor( fBeat );
				
				--what the fuck is this code!

				--if( fBeat >= fTotalTime )
				--break;
				
				if fBeat<fTotalTime then
				
					local fAmount = 0;
					if fBeat < fAccelTime then
						fAmount = scale( fBeat, 0.0, fAccelTime, 0.0, 1.0);
						fAmount = fAmount*fAmount;
					else 
						--fBeat < fTotalTime
						fAmount = scale( fBeat, fAccelTime, fTotalTime, 1.0, 0.0);
						fAmount = 1 - (1-fAmount) * (1-fAmount);
					end

					if bEvenBeat then
						fAmount = fAmount*-1;
					end

					local fShift = 20.0*fAmount*math.sin( (fOffset/15.0) + (math.pi/2) );
					--fPixelOffsetFromCenter += fEffects[PlayerOptions__EFFECT_BEAT] * fShift;
					local fPixelOffsetFromCenter = (fBeatStrength * fShift);
					
					a:addx(fPixelOffsetFromCenter*math.sin(ang));
					a:addy(-fPixelOffsetFromCenter*math.cos(ang));
					
				end
			
			end
		
		end
		
	end
	
	function nyan_update_notes()
		
		local beat = GAMESTATE:GetSongBeat()
		
		for i=1,table.getn(nyan_notes) do
			local note = nyan_notes[i]
			
			if note.active then
				
				nyan_arroweffects(note)
				
				if beat > note.beat then
					note.actor:hidden(1)
					note.beat = -1
					note.active = false;
				end
			end
			
		end
		
	end
	
	function nyan_update_flag()
	
		local beat = GAMESTATE:GetSongBeat()
		
		--nyan_plane:x( -nyan_world:GetX() + 80 )
		--nyan_plane:y( -nyan_world:GetY() - 150 )
		
		if beat > 80 and beat < 104 then
		
			for i=1,32 do
				local a = nyan_reme1[i]
				if a then
					a:hidden(0)
					a:rotationz(0)
					a:x( 1.2*math.sin(-mod_time*math.pi*2 + i) )
					a:skewx( 0.18*math.cos(-mod_time*math.pi*2 + i) )
					local brt = 0.9 - 0.1*math.sin(-mod_time*math.pi*2 + i-1)
					local brb = 0.9 - 0.1*math.sin(-mod_time*math.pi*2 + i)
					a:diffusetopedge( brt, brt, brt, 1 )
					a:diffusebottomedge( brb, brb, brb, 1 )
					a:y(8*(i-0.5))
					a:setstate(i-1)
				end
			end
		
		end
		
		if beat > 144 and beat < 168 then
		
			for i=1,32 do
				local a = nyan_reme2[i]
				if a then
					a:hidden(0)
					a:rotationz(0)
					a:x( 1.2*math.sin(-mod_time*math.pi*2 + i) )
					a:skewx( 0.18*math.cos(-mod_time*math.pi*2 + i) )
					local brt = 0.9 - 0.1*math.sin(-mod_time*math.pi*2 + i-1)
					local brb = 0.9 - 0.1*math.sin(-mod_time*math.pi*2 + i)
					a:diffusetopedge( brt, brt, brt, 1 )
					a:diffusebottomedge( brb, brb, brb, 1 )
					a:y(8*(i-0.5))
					a:setstate(i-1)
				end
			end
		
		end
		
	end
	
	function nyan_step(dir)
		local beat = GAMESTATE:GetSongBeat()
		if nyan_curhit < table.getn(nyan_chart) and not nyan_chart[nyan_curhit].hit and dir == nyan_chart[nyan_curhit][2] and math.abs(beat - nyan_chart[nyan_curhit][1]) < nyan_greatw then
			nyan_chart[nyan_curhit].hit = true
			nyan_curhit = nyan_curhit+1
		end
	end
	
	function nyan_update()
		
		local beat = GAMESTATE:GetSongBeat()
		
		--nyan_stealth = 0.5+0.5*math.cos(beat)
		
		nyan_beat = nyan_beat_aux:GetX();
		nyan_stealth = nyan_stealth_aux:GetX();
		nyan_lean = nyan_lean_aux:GetX();
		nyan_blink = nyan_blink_aux:GetX();
		nyan_tiny = nyan_tiny_aux:GetX();
		
		--Trace( nyan_lean );
		
		while nyan_curnote <= table.getn(nyan_chart) and beat > nyan_chart[nyan_curnote][1]-10 do
			if beat < nyan_chart[nyan_curnote][1]-1 then
				local bt = nyan_chart[nyan_curnote][1]
				local col = nyan_chart[nyan_curnote][2]
				local nt = nyan_chart[nyan_curnote][3]
				nyan_spawn_note(bt,col,nt,1)
			end
			nyan_curnote = nyan_curnote+1
		end
		
		nyan_world_rotation = 0
		nyan_world2:rotationz(nyan_world_rotation)
		
		if beat < 68 then
			nyan_sdelay = 0.5
		else
			nyan_sdelay = 0.25
		end
		
		if nyan_stimer <= 0 and beat > 20 then
			nyan_stimer = nyan_sdelay
			--Trace('Spawn Star');
			for i=1,2 do
				nyan_spawn_star(-nyan_world:GetX() + math.random(-sw*0.55,sw*0.55), -nyan_world:GetY() + math.random(-sh*0.55,sh*0.55) )
				--nyan_spawn_star( math.random(0,sw), math.random(0,sh) )
			end
		else
			nyan_stimer = nyan_stimer-(1/60)
		end
		
		nyan_update_notes()
		
		nyan_update_flag()
		
		local backtrace = 4
		if beat < 18 then
			backtrace = 4
		elseif beat >= 18 and beat < 22 then
			backtrace = 4-4*outQuad((beat-18)/4,0,1,1)
		elseif beat > 22 then
			backtrace = 0
		end
		
		nyan_world:x( 0 - nyan_getpos(beat+1).x )
		nyan_world:y( 0 - nyan_getpos(beat+1).y )
		nyan_cat:rotationz( math.deg(nyan_getang(beat-.8)) )
		nyan_cat:x( nyan_getpos(beat-.8 - backtrace).x )
		nyan_cat:y( nyan_getpos(beat-.8 - backtrace).y )
		
		nyan_leg1:x( 24 + 2*math.sin(0.5*beat*math.pi) )
		nyan_leg1:y( 43 + 2*math.cos(0.5*beat*math.pi) )
		nyan_leg1:rotationz( 4*math.cos(0.5*beat*math.pi) )
		nyan_leg2:x( 24 + 2*math.sin(0.5*beat*math.pi + math.pi*0.5) )
		nyan_leg2:y( 43 + 2*math.cos(0.5*beat*math.pi + math.pi*0.5) )
		nyan_leg2:rotationz( 10 - 4*math.cos(0.5*beat*math.pi + math.pi*0.5) )
		
		nyan_hand1:x( -30 + 2*math.sin(0.5*beat*math.pi + math.pi*0.25) )
		nyan_hand1:y( 49 + 2*math.cos(0.5*beat*math.pi + math.pi*0.25) )
		nyan_hand1:rotationz( -20 - 4*math.cos(0.5*beat*math.pi + math.pi*0.25) )
		nyan_hand2:x( -30 + 2*math.sin(0.5*beat*math.pi + math.pi*0.5 + math.pi*0.25) )
		nyan_hand2:y( 49 + 2*math.cos(0.5*beat*math.pi + math.pi*0.5 + math.pi*0.25) )
		nyan_hand2:rotationz( -30 - 4*math.cos(0.5*beat*math.pi + math.pi*0.5 + math.pi*0.25) )
		
		if FUCK_EXE and beat > 12 then
			
			local wid = 26
			
			local ta = 0
			if math.mod(beat-.05,1) > 0.5 then
				ta = 0.5
			end
			
			local behind = 1.2
			if slumpo then behind = .8 end
			
			for i=0,31,2 do
			
				local ang = nyan_getang(beat-behind - i*0.25)
				local xp = nyan_getpos(beat-behind - backtrace - i*0.125 ).x + 12*math.sin(ang)
				local yp = nyan_getpos(beat-behind - backtrace - i*0.125 ).y - 12*math.cos(ang)
				
				nyan_trail:SetVertexPosition( i, xp+wid*math.sin(ang), yp-wid*math.cos(ang), 0 )
				nyan_trail:SetVertexPosition( i+1, xp-wid*math.sin(ang), yp+wid*math.cos(ang), 0 )
				
				nyan_trail:SetVertexTexCoord( i, (i/32)*8+ta, 0 )
				nyan_trail:SetVertexTexCoord( i+1, (i/32)*8+ta, 1 )
				
				nyan_trail:SetVertexColor( i, 1, 1, 1, 1-(i/32) )
				nyan_trail:SetVertexColor( i+1, 1, 1, 1, 1-(i/32) )
				
			end
			
		end
		
		if not FUCK_EXE and beat > 12 then
			
			nyan_rtimer = nyan_rtimer-(1/60)
			
			local behind = .8
			if slumpo then behind = .6 end
			
			if nyan_rtimer < 0 then
			
				local ang = nyan_getang(beat-behind)
				local xp = nyan_getpos(beat-behind - backtrace ).x + 12*math.sin(ang)
				local yp = nyan_getpos(beat-behind - backtrace ).y - 12*math.cos(ang)
			
				local a = nyan_get_trail()
				if a then
				
					--Trace( tostring(a) )
					
					a:hidden(0)
					a:finishtweening()
					a:horizalign('right')
					a:rotationz(math.deg(ang))
					a:zoom(.45)
					a:setstate(0)
					a:y( yp )
					a:x( xp )
					a:diffusealpha(1)
					a:linear(1)
					a:diffusealpha(0)
					a:queuecommand('Hide')
					
				end
			
				nyan_rtimer = nyan_rdelay
			end
			
		end
		
		if beat < 96 or beat >=152 and beat < 160 or beat >= 216 then
			nyan_mine1:x(300)
			nyan_mine1:zoom(0)
			nyan_mine2:x(300)
			nyan_mine2:zoom(0)
		elseif beat >= 96 and beat < 100 then
			nyan_mine1:x(300 - 300*outQuad((beat-96)/4,0,1,1))
			nyan_mine1:zoom(outQuad((beat-96)/4,0,1,1)/0.6)
		elseif beat >= 100 and beat < 148 then
			nyan_mine1:x(0)
			nyan_mine1:zoom(1/0.6)
		elseif beat >= 148 and beat < 152 then
			nyan_mine1:x(300*inQuad((beat-148)/4,0,1,1))
			nyan_mine1:zoom((1-inQuad((beat-148)/4,0,1,1))/0.6)
		elseif beat >= 160 and beat < 164 then
			nyan_mine1:x(300 - 300*outQuad((beat-160)/4,0,1,1))
			nyan_mine1:zoom(outQuad((beat-160)/4,0,1,1)/0.6)
			nyan_mine2:x(300 - 300*outQuad((beat-160)/4,0,1,1))
			nyan_mine2:zoom(outQuad((beat-160)/4,0,1,1)/0.6)
		elseif beat >= 164 and beat < 212 then
			nyan_mine1:x(0)
			nyan_mine1:zoom(1/0.6)
			nyan_mine2:x(0)
			nyan_mine2:zoom(1/0.6)
		elseif beat >= 212 and beat < 216 then
			nyan_mine1:x(300*inQuad((beat-212)/4,0,1,1))
			nyan_mine1:zoom((1-inQuad((beat-212)/4,0,1,1))/0.6)
			nyan_mine2:x(300*inQuad((beat-212)/4,0,1,1))
			nyan_mine2:zoom((1-inQuad((beat-212)/4,0,1,1))/0.6)
		end
		
		nyan_mine1:y( 150*math.sin(beat*math.pi*0.25 + math.pi) )
		nyan_mine1:z( 180*math.cos(beat*math.pi*0.25 + math.pi) )
		
		nyan_mine2:x(0)
		nyan_mine2:y( 150*math.sin(beat*math.pi*0.25) )
		nyan_mine2:z( 180*math.cos(beat*math.pi*0.25) )
		
		nyan_plane:x( nyan_getpos(beat+1).x )
		nyan_plane:y( nyan_getpos(88).y-150 )
		
		if beat > 20 then
			nyan_intro_sky2:y( -nyan_cat:GetY()/8 + nyan_getpos(88).y/8 + sh )
		end
		
		while nyan_bite < table.getn(nyan_chart) and beat > nyan_chart[nyan_bite][1]-.25 do
			if beat < nyan_chart[nyan_bite][1]+1 then
				nyan_cat:playcommand('Chomp');
			end
			nyan_bite = nyan_bite+1
		end
		
		while nyan_bit < table.getn(nyan_chart) and beat > nyan_chart[nyan_bit][1] do
			if beat < nyan_chart[nyan_bit][1]+1 then
			
				--Trace('spawn');
				
				local a = nyan_get_nhit();
				
				--Trace(tostring(a))
				
				if a then
					--Trace('spawn');
					a:hidden(0)
					a:setstate(0)
					a:animate(1);
					a:zoom(0.9);
					a:rotationz(math.random(0,360))
					a:x( nyan_getpos(beat).x )
					a:y( nyan_getpos(beat).y )
					a:sleep(0.3)
					a:queuecommand('Hide')
				end
				
			end
			nyan_bit = nyan_bit+1
		end
		
		local isAutoplay = PREFSMAN:GetPreference('AutoPlay') -- :/
		
		while nyan_curhit <= table.getn(nyan_chart) and beat > nyan_chart[nyan_curhit][1]+nyan_greatw do
			
			if FUCK_EXE and beat < nyan_chart[nyan_curhit][1]+1 then 
				
				if isAutoplay == 0 then
					taro_Sound('hurt')
					nyan_cat:playcommand('Hurt')
					
					local a
					local last = false
					
					if nyan_chart[nyan_curhit][1] == 216 and slumpo then
						a = nyan_get_ndk()
						last = true
					else
						a = nyan_get_nded()
					end
					
					--Trace(tostring(a))
					
					local col = nyan_chart[nyan_curhit][2]
					
					
					
					local rng = math.random(-10,10)
					local rng2 = math.random(80,100)
					
					if a then
						--Trace('spawn');
						a:hidden(0)
						a:diffusealpha(1)
						
						if not last then
							if col == 0 or col == 3 then
								a:setstate(1)
							else
								a:setstate(2)
							end
							if col == 3 then
								a:basezoomx(-1)
							else
								a:basezoomx(1)
							end
							if col == 2 then
								a:basezoomy(-1)
							else
								a:basezoomy(1)
							end
						else
							a:setstate(5)
							a:rotationx(45)
							a:rotationy(20)
						end
						--a:animate(1);
						a:zoom(1.2);
						a:rotationz(rng)
						a:x( nyan_getpos(beat).x + 5 )
						a:y( nyan_getpos(beat).y - 20 )
						a:decelerate(0.3)
						a:addy(-100*math.cos(nyan_getang(beat)))
						a:addx(100*math.sin(nyan_getang(beat)))
						a:rotationz(rng-rng2)
						a:accelerate(0.2)
						a:rotationz(rng-rng2-10)
						a:addy(70)
						a:diffusealpha(0)
						a:queuecommand('Hide')
					end
				end
				
			end
			
			nyan_chart[nyan_curhit].hit = true
			nyan_curhit = nyan_curhit+1
			
		end
		
	end
	
	--[[
	screen:x(sw/2)
	screen:y(sh/2)
	screen:zoom(0.1)
	]]
	
	
end"
><children>

	<Layer
		Type="Quad"
		InitCommand="hidden,1"
		OnCommand="sleep,1000"
	/>
	
	<Layer File="modhelpers.xml" />
	<Layer File="easing.xml" />
	<Layer File="../nyan_chart_0.xml" />
	<Layer File="../nyan_chart_1.xml" />
	
	<Layer
		Type="Quad"
		OnCommand="hidden,1"
		InitCommand="%function(self)
		
			checked = false; P1=nil;P2=nil;P3=nil;P4=nil;jud1=nil;com1=nil;jud2=nil;com2=nil;jud3=nil;com3=nil;
			
			nyan_chart = nyan_chart_0
			
			if slumpo then
				nyan_chart = nyan_chart_1
			end
			
			for i=1,table.getn(nyan_chart) do
				nyan_chart[i].hit = false;
			end
			
		
			---------------------------------------------------------
			---------DOCUMENTATION-----------------------------------
			---------------------------------------------------------
			
			--function perframe( beat, endBeat )
				--return true if the current beat is between 'beat' and 'endBeat'
			
			--function mod_shader(beat,key,which)
				--turn on shader key at specified beat (up to 10 keys available, defined by 'which' = 0-9
				
			--function mod_insert(beat,len,mod,len_or_end,pn)
				--insert mod into beat mods table
			--function mod_insert2(time,len,mod,len_or_end,pn)
				--insert mod into time mods table
				
			--function mod_message(beat,msg,persistent)
				--insert something into the actions table.
				--msg can also be a function. If string, a message gets broadcast at that beat
				--if 'persistent' is true, message will run even if editor starts at a beat past it
				
			--function mod_blacklist(t,n)
				--check if number n occurs in table t
				--useful for doing 'every beat EXCEPT the contents of t'
				
			--function simple_m0d(beat,strength,mult,mod)
			--function simple_m0d2(beat,strength,mult,mod,pn)
			--function simple_m0d3(beat,strength,duration,bpm,mod,pn)
				--activate mods at specific beat but also deactivate them
				
			--function mod_wiggle(beat,num,div,amt,speed,mod,pn,first)
				--alternates a mod back and forth before resetting to 0
				
			--function mod_springt(time,strength,dur,mod,pn)
				--time-based per-frame alternating mod that decreases based on how much time is left.
					--think doorstopper
			
			--function mod_springt2(time,strength,dur,mod,pn)
				--time-based per-frame alternating mod
			
			--function mod_onebeat(beat,strength,pn)
				--turns on beat for the beat specified, at the desired strength	
			
			--function switcheroo_add(beat,which,speed,len,pn)
				--adds a column swap at the desired beat
			--[[	switcheroos = {normal = {0,0}, ldur = {0,0}, reset = {0,0},
					flip = {100,0}, rudl = {100,0}, invert = {0,100}, dlru = {0,100},
					ludr = {25,-75}, rdul = {75,75}, drlu = {25,125}, ulrd = {75,-125}, urld = {100,-100}}
			]]
			
			--use a variable called 'switcheroo_width' to change how much space is between each column
			--e.g. switcheroo_width = 2 for ayakashi
			
			--function mod_sugarkiller(beat,duration,speed,minstealth,maxstealth,pn)
				--portable version of the effect from sugarkill X
				
			--function doSpline(spd, axis, path, col)
				--draws spline 'path' in specified axis, for specific col. Offsets are *10000, but positions use *spd
				
			--function doSplineAll(spd, axis, path)
				--same as above, but for all columns
				--(faster performance than using doSpline 4 times due to more efficient concat)
			
			--function mindf_rotateAndCounter(xDegrees, yDegrees, zDegrees, player)
				--counteract euler rotations after rotating player in multiple axes, using a TON of math.
			
			
			---------------------------------------------------------
			--------END DOCUMENTATION--------------------------------
			---------------------------------------------------------
			
			local m = mod_insert
			local m2 = mod_message
			local me = mod_ease
			
			
			local l = 'len'
			local e = 'end'
			
			
			
			
			
			
			
			init_modsp1 = '';
			init_modsp2 = '';
			
			mod_plr = {};
			
			mod_firstSeenBeat = GAMESTATE:GetSongBeat(); --necessary to prevent long freezes
			
			
			
			
			
			
			
			
			
			
			
---------------------------------------------------------------------------------------
----------------------Begin tables 'n stuff--------------------------------------------
---------------------------------------------------------------------------------------

			--beat based mods
			--{beat_start, beat_end, mods, len_or_end, player_number}
			mods = {
				{0,9999,'*2 2x, *1000 no beat, *1000 stealth, *1000 -200 reverse, *10000 -100000 cover','end'},
			}
			
			--switcheroos = {{0,0},{100,0},{0,100},{25,-75},{75,75},{25,125},{75,-125},{100,-100}}
			
			
			
			
			
			
			
			--time based mods
			mod_time = 0;
			--{time_start, time_end, mods, len_or_end, player_number}
			mods2 = {
				--{0,200.345,'3x','end',1},
			}
			
			
			
			
			--this is both a message broadcaster and a function runner
			--if you put {beat,'String'}, then 'String' is broadcast as a message on that beat
			--if you put {beat,function() somecode end}, then function() is run at that beat
			--see example on beat 32
			
			curaction = 1;
			--{beat,thing,persists}
			mod_actions = {
			
			
				
			}
			
			
			
			
			
			
			--beat-based ease mods
			--{time_start, time_end, mod_start, mod_end, mod, len_or_end, ease_type, player_number, sustaintime, optional_param1, optional_param2}
			--valid ease types are:
				--linear
				--inQuad    outQuad    inOutQuad    outInQuad
				--inCubic   outCubic   inOutCubic   outInCubic
				--inQuart   outQuart   inOutQuart   outInQuart
				--inQuint   outQuint   inOutQuint   outInQuint
				--inSine    outSine    inOutSine    outInSine
				--inExpo    outExpo    inOutExpo    outInExpo
				--inCirc    outCirc    inOutCirc    outInCirc
				--inElastic outElastic inOutElastic outInElastic    --can take 2 optional parameters - amplitude & period
				--inBack    outBack    inOutBack    outInBack       --can take 1 optional parameter  - spring amount
				--inBounce  outBounce  inOutBounce  outInBounce
				
			mods_ease = {
				-- EXAMPLE TWEEN: from beat 0 to 4, make rotationz go from 360 to 0 with the inOutBack tween
				--{0,4,360,0,'rotationz','end',inOutBack},
			}
			
			
			
			
			
			
			
			
			
			
			m(234,999,'*1000 disablemines, *1000 hidemines, *1000 stealthpastreceptors',e)
			
			m2(0,function()
			
				local found = false
				for pn=1,2 do
					local a = Plr(pn)
					if a then
						if not found and FUCK_EXE then
						
							nyan_chart = a:GetNoteData()
							
							for i=table.getn(nyan_chart),1,-1 do
								if nyan_chart[i][3] == 'M' or nyan_chart[i][3] >= 100 then
									table.remove(nyan_chart,i)
								end
							end
						
							found = true
						end
					end
				end
				
				table.insert(nyan_chart,{9999,2,'M'})
			
				for pn=1,2 do
					local a = Plr(pn)
					if a then
						a:y(sh/2 - 60)
						a:GetChild('Judgment'):GetChild(''):Load(songName..'lua/judgecat 1x6.png');
					end
					
					local a = GetJud(pn)
					if a then
						a:bob()
						a:effectperiod(1000000)
						a:effectoffset(250000)
						a:effectmagnitude(0,180,0)
					end
					local a = GetCom(pn)
					if a then
						a:bob()
						a:effectperiod(1000000)
						a:effectoffset(250000)
						a:effectmagnitude(0,160,0)
					end
					
					if FUCK_EXE then
						--a:SetNote
					end
					
				end
				
				nyan_plane_inner:x(-sw + 100)
				
				if slumpo then
					nyan_rdelay = .075
				end
				
				--Trace( 'x: '..(nyan_getpos(88).x)..' y: '..(nyan_getpos(88).y) );
				
			end,true)
			
			m2(80,function()
				if not slumpo then
					nyan_plane_inner:x(-sw + 100)
					nyan_plane_inner:decelerate(480/142)
					nyan_plane_inner:x(0 + 100)
					nyan_plane_inner:sleep(480/142)
					nyan_plane_inner:accelerate(480/142)
					nyan_plane_inner:x(sw + 100)
				end
			end)
			
			m2(104,function()
			
				nyan_plane_inner:x(sw + 100)
				
				for i=1,32 do
					local a = nyan_reme1[i]
					if a then
						a:hidden(1)
					end
				end
				
			end,true)
			
			m2(144,function()
				if not slumpo then
					nyan_plane_inner:x(-sw + 100)
					nyan_plane_inner:decelerate(480/142)
					nyan_plane_inner:x(0 + 100)
					nyan_plane_inner:sleep(480/142)
					nyan_plane_inner:accelerate(480/142)
					nyan_plane_inner:x(sw + 100)
				end
			end)
			
			m2(168,function()
			
				nyan_plane_inner:x(sw + 100)
				
				for i=1,32 do
					local a = nyan_reme2[i]
					if a then
						a:hidden(1)
					end
				end
				
			end,true)
			
			if not slumpo then
				m2(86,'Alert');
				m2(150,'Alert');
			end
			
			m2(216,'FadeOut');
			
			
			
			
			
			---------------------------------
			--mods...!
			
			--tt = 0 - linear, 1 - inQuad, 2 - outQuad, 3 - inOutQuad
			function me2(beat,b2,samt,eamt,mname,lt,tt)
				if not tt then tt = 1 end
				m2(beat,function()
					local a = _G['nyan_'..mname..'_aux']
					if a then
						local dur = (b2-beat)*(60/142)
						if lt == 'len' then
							dur = (b2)*(60/142)
						end
						a:finishtweening();
						a:sleep(0)
						if tt < 3 then
							a:x(samt)
							if tt == 0 then
								a:linear(dur)
							elseif tt == 1 then
								a:accelerate(dur)
							elseif tt == 2 then
								a:decelerate(dur)
							end
							a:x(eamt)
						else
							a:x(samt)
							a:accelerate(dur/2)
							a:x( samt + (eamt-samt)/2 )
							a:decelerate(dur/2)
							a:x(eamt)
						end
					end
				end,true)
			end
			
			local function nya_nya(beat)
				local mul = 1
				if beat > 152 then
					mul = 2.5
				end
				m2(beat-.1,function()
					nyan_tiny_aux:finishtweening()
					nyan_tiny_aux:linear(.05)
					nyan_tiny_aux:x(-1*mul)
					nyan_tiny_aux:linear(60/142 - .05)
					nyan_tiny_aux:x(0)
					nyan_tiny_aux:linear(.05)
					nyan_tiny_aux:x(-1*mul)
					nyan_tiny_aux:linear(60/142 - .05)
					nyan_tiny_aux:x(0)
				end,true)
			end
			
			local function nyanya(beat)
				local mul = 1
				if beat > 152 then
					mul = 2
				end
				m2(beat-.1,function()
					nyan_tiny_aux:finishtweening()
					nyan_tiny_aux:linear(.05)
					nyan_tiny_aux:x(-1*mul)
					nyan_tiny_aux:linear(30/142 - .05)
					nyan_tiny_aux:x(0)
					nyan_tiny_aux:linear(.05)
					nyan_tiny_aux:x(-1*mul)
					nyan_tiny_aux:linear(60/142 - .05)
					nyan_tiny_aux:x(0)
				end,true)
			end
			
			
			
			
			
			
			
			me2(23.5,0,0,1,'beat',l)
			
			me2(40,4,0,1,'lean',l,2)
			me2(52,4,1,0,'lean',l,2)
			
			me2(56,8,0,.5,'blink',l)
			
			for i=0,3 do
				nya_nya(56+8*i)
				nyanya(60+8*i)
			end
			
			me2(80,6,1,0,'beat',l)
			me2(80,6,.5,0,'blink',l)
			
			me2(95.5,0,0,1,'beat',l)
			
			if not slumpo then
				me2(119.75,.25,0,1,'blink',l)
			end
			
			for i=0,3 do
				nya_nya(120+8*i)
				nyanya(124+8*i)
			end
			
			me2(144,6,1,0,'beat',l)
			if not slumpo then
				me2(144,6,1,0,'blink',l)
			end
			
			me2(159.5,0,0,1.5,'beat',l)
			
			for i=0,3 do
				nya_nya(184+8*i)
				nyanya(188+8*i)
			end
			
			if not slumpo then
				me2(184,216,0,0.5,'stealth',e)
			else
				me2(184,216,0,0.4,'stealth',e)
			end
			
			if not slumpo then
				me2(176,8,0,1,'lean',l,3)
				me2(184,8,1,-1.5,'lean',l,3)
				me2(192,8,-1.5,2,'lean',l,3)
				me2(200,8,2,-1,'lean',l,3)
				me2(208,8,-1,0,'lean',l,3)
			else
				me2(176,8,0,1*0.75,'lean',l,3)
				me2(184,8,1*0.75,-1.5*0.75,'lean',l,3)
				me2(192,8,-1.5*0.75,2*0.75,'lean',l,3)
				me2(200,8,2*0.75,-1*0.75,'lean',l,3)
				me2(208,8,-1*0.75,0,'lean',l,3)
			end
			
			
			
			
			
			
			
			
			-----------------------------
			
			local function int(beat,num)
				m2(beat,'Intro'..num)
			end
			
			int(5,2)
			int(5.1,1)
			
			m2(7.5,function()
				nyan_intro_all:accelerate(.4)
				nyan_intro_all:zoom(1/1.15)
				nyan_intro_all:decelerate(.4)
				nyan_intro_all:zoom(1/1.3)
			end)
			
			m2(6,function()
				nyan_intro_candy:linear(.8)
				nyan_intro_candy:x(-90)
				nyan_intro_candy:GetChild(''):sleep(.8)
				nyan_intro_candy:GetChild(''):spring(.6)
				nyan_intro_candy:GetChild(''):rotationz(0)
			end)
			
			m2(10.6,function()
				nyan_intro_question:rotationz(-10)
				nyan_intro_question:x(40)
				nyan_intro_question:y(-150)
				nyan_intro_question:basezoomx(2)
				nyan_intro_question:basezoomy(2)
				nyan_intro_question:hidden(0)
				nyan_intro_question:bounceend(0.1)
				nyan_intro_question:zoomy(1)
				nyan_intro_question:sleep(0)
				nyan_intro_question:accelerate(0.4)
				nyan_intro_question:diffusealpha(0)
			end)
			
			int(7,2)
			int(7.1,1)
			int(7.375,2)
			int(7.475,1)
			
			int(9.75,3)
			int(9.875,4)
			--int(10.75,4)
			int(11.75,5)
			int(12.875,6)
			
			--[[
			int(14,7)
			int(14.5,8)
			int(15.125,7)
			int(15.625,8)
			]]
			
			
			
			m2(14,function()
				
				--[[
				nyan_intro_candy:linear(.3)
				nyan_intro_candy:addx(-30)
				
				nyan_intro_candy:GetChild(''):linear(.3)
				nyan_intro_candy:GetChild(''):rotationz(-1)
				nyan_intro_candy:GetChild(''):spring(.2)
				nyan_intro_candy:GetChild(''):rotationz(0)
				]]
				
				nyan_intro_neko:linear(.3)
				nyan_intro_neko:addx(-30)
				
				nyan_intro_neko:vibrate()
				nyan_intro_neko:effectmagnitude(0,5,0)
				
			end)
			m2(14.5,function()
				nyan_intro_neko:stopeffect()
			end)
			m2(15.125,function()
			
				nyan_intro_candy:accelerate(1)
				nyan_intro_candy:addx(-sw*0.8)
				
				nyan_intro_candy:GetChild(''):accelerate(.2)
				nyan_intro_candy:GetChild(''):rotationz(-3)
				
				nyan_intro_neko:linear(.3)
				nyan_intro_neko:addx(-30)
				
				nyan_intro_neko:vibrate()
				nyan_intro_neko:effectmagnitude(0,5,0)
				
			end)
			m2(15.625,function()
				nyan_intro_neko:stopeffect()
			end)
			
			m2(16,function()
				nyan_intro_sky:accelerate(120/142)
				nyan_intro_sky:addy(sh/2)
				nyan_intro_sky:decelerate(120/142)
				nyan_intro_sky:addy(sh/2)
				nyan_intro_all:accelerate(120/142)
				nyan_intro_all:addy(sh/2)
				nyan_intro_all:decelerate(120/142)
				nyan_intro_all:addy(sh/2)
			end)
			m2(20,function()
				nyan_intro_sky:y(sh/2 + sh)
				nyan_intro_all:y(sh/2 + sh)
			end,true)
			
			
			
			
---------------------------------------------------------------------------------------
----------------------Sort the actions table-------------------------------------------
---------------------------------------------------------------------------------------
			
			function modtable_compare(a,b)
				return a[1] < b[1]
			end
			
			if table.getn(mod_actions) > 1 then
				table.sort(mod_actions, modtable_compare)
			end
			
			self:queuecommand('Update');
			
		end"
		
		UpdateCommand="%function(self)

			if GAMESTATE:GetSongBeat()>=0 and not checked then
			
				local ThingsToGrab = {'LifeP1','LifeP2','ScoreP1','ScoreP2','BPMDisplay','LifeFrame','ScoreFrame',
										'Lyrics','SongBackground','SongForeground','Overlay','Underlay'}
				local ThingsToHide = {'LifeP1','LifeP2','ScoreP1','ScoreP2','BPMDisplay','LifeFrame','ScoreFrame','Overlay','Underlay'}
				
				for i,v in ipairs(ThingsToGrab) do
					_G[v] = SCREENMAN:GetTopScreen():GetChild(v) or nil
				end
				
				for i,v in ipairs(ThingsToHide) do
					if _G[v] then _G[v]:hidden(1) end
				end
				
				table.insert(mod_plr,SCREENMAN:GetTopScreen():GetChild('PlayerP1'));
				table.insert(mod_plr,SCREENMAN:GetTopScreen():GetChild('PlayerP2'));
				
				--name players, judgment and combo
				for pn=1,2 do
					_G['P'..pn] = SCREENMAN:GetTopScreen():GetChild('PlayerP'..pn) or nil;
					if _G['P'..pn] then
						--_G['P'..pn]:z(1)
						_G['jud'..pn] = _G['P'..pn]:GetChild('Judgment');
						_G['com'..pn] = _G['P'..pn]:GetChild('Combo');
					end
				end
				
				screen = SCREENMAN:GetTopScreen();
				checked = true; --let this only run once
				
				--screen:SetDrawByZPosition(true)
				
			end

			local beat = GAMESTATE:GetSongBeat()
			
			
---------------------------------------------------------------------------------------
----------------------Begin table handlers---------------------------------------------
---------------------------------------------------------------------------------------
			
			disable = false;
			if disable ~= true and beat > mod_firstSeenBeat+0.1 and checked then
				
				-----------------------
				-- Player mod resets --
				-----------------------
				if beat > mod_firstSeenBeat+0.1 then -- performance coding!! --
					for i=1,2 do
						mod_do('clearall',i)
					end
				end
				
				------------------------------------------------------------------------------
				-- custom mod reader by TaroNuke edited by WinDEU and re-stolen by TaroNuke --
				------------------------------------------------------------------------------
				if beat > mod_firstSeenBeat+0.1 then -- performance coding!! --
					for i,v in pairs(mods) do
						if v and table.getn(v) > 3 and v[1] and v[2] and v[3] and v[4] then
							if beat >=v[1] then
								if (v[4] == 'len' and beat <=v[1]+v[2]) or (v[4] == 'end' and beat <=v[2]) then
									if table.getn(v) == 5 then
										mod_do(v[3],v[5]);
									else
										mod_do(v[3]);
									end
								end
							end
						else
							v[1] = 0;
							v[2] = 0;
							v[3] = '';
							v[4] = 'error';
							SCREENMAN:SystemMessage('Bad mod in beat-based table (line '..i..')');
						end
					end
				end
				
				-----------------------------------------------------------------------------------------------------
				-- WinDEU's time-based len/end version of the #swag custom mod reader #teamproofofconcept (c) 2015 --
				-----------------------------------------------------------------------------------------------------
				if beat > mod_firstSeenBeat+0.1 then -- performance coding!! --
					for i,v in pairs(mods2) do
						if v and table.getn(v) > 3 and v[1] and v[2] and v[3] and v[4] then
							if mod_time >=v[1] then
								if (v[4] == 'len' and mod_time <=v[1]+v[2]) or (v[4] == 'end' and mod_time <=v[2]) then
									if table.getn(v) == 5 then
										mod_do(v[3],v[5]);
									else
										mod_do(v[3]);
									end
								end
							end
						else
							v[1] = 0;
							v[2] = 0;
							v[3] = 'error';
							v[4] = 'error';
							SCREENMAN:SystemMessage('Bad mod in time-based table (line '..i..')');
						end
					end
				end
				
				--------------------------------------------------------------------------------------
				-- i dont know who this reader is but he looks like he is made out of EASE HAHAHAHA --
				-- original code by exschwasion, bastardized by taro for cmod support and less 'if' --
				--------------------------------------------------------------------------------------
				for i,v in pairs(mods_ease) do
					if v and table.getn(v) > 6 and v[1] and v[2] and v[3] and v[4] and v[5] and v[6] and v[7] then
						if beat >=v[1] then
							if (v[6] == 'len' and beat <=v[1]+v[2]) or (v[6] == 'end' and beat <=v[2]) then
								
								local duration = v[2];
								if v[6] == 'end' then duration = v[2] - v[1] end
								local curtime = beat - v[1]
								local diff = v[4] - v[3]
								local startstrength = v[3]
								local curve = v[7]
								local mod = v[5]
								
								local strength = curve(curtime, startstrength, diff, duration, v[10], v[11]) --extra parameters for back and elastic eases :eyes:
								
								local modstr = v[5] == 'xmod' and strength..'x' or (v[5] == 'cmod' and 'C'..strength or strength..' '..v[5])
								mod_do('*10000 '..modstr,v[8]);
								
							elseif (v[9] and ((v[6] == 'len' and beat <=v[1]+v[2]+v[9]) or (v[6] == 'end' and beat <=v[9]))) then
							
								local strength = v[4]
								
								local modstr = v[5] == 'xmod' and strength..'x' or (v[5] == 'cmod' and 'C'..strength or strength..' '..v[5])
								mod_do('*10000 '..modstr,v[8]);
								
							end
						end
					else
						SCREENMAN:SystemMessage('Bad mod in beat-based ease table (line '..i..')');
					end
				end
				
				--------------------
				-- Perframe stuff --
				--------------------
				
				nyan_update()
				
				---------------------------------------
				-- ACTION RPGS AINT GOT SHIT ON THIS --
				---------------------------------------
				if beat > mod_firstSeenBeat+0.1 then -- performance coding!! --
					while curaction<=table.getn(mod_actions) and GAMESTATE:GetSongBeat()>=mod_actions[curaction][1] do
						if mod_actions[curaction][3] or GAMESTATE:GetSongBeat() < mod_actions[curaction][1]+2 then
							if type(mod_actions[curaction][2]) == 'function' then
								mod_actions[curaction][2]()
							elseif type(mod_actions[curaction][2]) == 'string' then
								MESSAGEMAN:Broadcast(mod_actions[curaction][2]);
							end
						end
						curaction = curaction+1;
					end
				end
				
			end
			
			self:sleep(1/60);
			self:queuecommand('Update');

---------------------------------------------------------------------------------------
----------------------END DON'T TOUCH IT KIDDO-----------------------------------------
---------------------------------------------------------------------------------------
			
		end"
		
	/>
	
	<!--Handling messages here is still fun and profitable-->
	<CODE Type="Quad" OnCommand="hidden,1"
	InitCommand="%function(self) rb_aux = self end"
	/>
	
	
	
	<Layer File="dunno1" OnCommand="hidden,1" />
	<Layer File="dunno2" OnCommand="hidden,1" />
	
	<Layer Type="ActorFrame" OnCommand="%function(self) nyan_world2 = self; self:x(sw/2); self:y(sh/2) end" ><children>
	<Layer Type="ActorFrame" OnCommand="%function(self) nyan_world = self end" ><children>
	
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		<Layer File="_star" OnCommand="hidden,1;sleep,0.02;queuecommand,Make;" HideCommand="hidden,1"  MakeCommand="%function(self) nyan_make_star(self) end" />
		
		<Layer Type="ActorFrame" InitCommand="%function(self) nyan_plane = self end" OnCommand="bob;effectperiod,2;effectmagnitude,0,4,0;" ><children>
		<Layer Type="ActorFrame" InitCommand="%function(self) nyan_plane_inner = self end" OnCommand="bob;effectperiod,2.5;effectmagnitude,4,0,0;" ><children>
		<Layer Type="ActorFrame" OnCommand="rotationz,90;x,-96" ><children>
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		<Layer File="remeber1" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme1(self) end" />
		
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		<Layer File="remeber2" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_reme2(self) end" />
		</children></Layer>
		<Layer File="plane" />
		</children></Layer>
		</children></Layer>
		
		<!--Layer File="neko" InitCommand="%function(self) nyan_cat = self end" OnCommand="x,sw*0.25;y,sh*0.5;diffuse,1,0,0,1;" /-->
		
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		<Layer File="rainbow" OnCommand="hidden,1;sleep,0.02;queuecommand,Make" HideCommand="hidden,1;" MakeCommand="%function(self) nyan_make_trail(self) end" />
		
		<Layer File="trail" InitCommand="%function(self) nyan_rainbowtex = self end" />
		
		<Layer Condition="FUCK_EXE" Type="Polygon" OnCommand="hidden,0;sleep,.02;queuecommand,Make"
			InitCommand="%function(self) nyan_trail = self end"
			DrawMode="QuadStrip"
			MakeCommand="%function(self)
				
				self:SetPolygonMode(0)
				
				self:SetNumVertices(32)
				
				self:texturewrapping(1)
				self:SetTexture(nyan_rainbowtex:GetTexture())
				
			end"
		/>
		
		<Layer Type="ActorFrame" InitCommand="%function(self) nyan_cat = self end" OnCommand="zoom,0.6;x,sw*0.25;y,sh*0.5;" ><children>
			<Layer Type="ActorFrame" OnCommand="zoomx,-1;y,-30;x,-15;bob;effectperiod,2;effectmagnitude,0,3,0;fov,60;queuecommand,SDBZP" SDBZPCommand="%function(self) self:SetDrawByZPosition(true) end" ><children>
				<Layer File="neko/wag" OnCommand="setstate,10;y,10;x,90;zoom,.9;effectclock,bgm;" />
				<Layer File="neko/leg" InitCommand="%function(self) nyan_leg2 = self end" OnCommand="y,45;x,24;zoom,.95;diffuse,.9,.9,.9,1;" />
				<Layer File="neko/hand" InitCommand="%function(self) nyan_hand2 = self end" OnCommand="y,50;x,-30;zoom,.95;diffuse,.9,.9,.9,1;" />
				<Layer File="neko/tarte" OnCommand="zoom,.8;y,5;" />
				<Layer File="neko/hand" InitCommand="%function(self) nyan_hand1 = self end" OnCommand="y,50;x,-30;" />
				<Layer File="neko/leg" InitCommand="%function(self) nyan_leg1 = self end" OnCommand="y,45;x,24;" />
				<Layer File="neko/idle" OnCommand="y,10;x,-90;" ChompCommand="finishtweening;diffusealpha,0;sleep,0.54;diffusealpha,1;" HurtCommand="finishtweening;diffusealpha,0;sleep,0.2;diffusealpha,1;" />
				<Layer File="neko/chomp" OnCommand="y,10;x,-90;diffusealpha,0;" ChompCommand="finishtweening;setstate,0;diffusealpha,1;sleep,0.54;diffusealpha,0;" HurtCommand="finishtweening;diffusealpha,0;" />
				<Layer File="neko/hurt" OnCommand="y,10;x,-90;diffusealpha,0;" HurtCommand="finishtweening;diffuse,1,.5,.5,1;y,24;spring,0.2;y,10;diffuse,1,1,1,1;sleep,0;diffusealpha,0;" />
				<Layer File="mine/_mine.model" InitCommand="%function(self) nyan_mine1 = self end" OnCommand="z,10;basezoomx,-1;zoom,1/0.6;cullmode,none" />
				<Layer File="mine/_mine.model" InitCommand="%function(self) nyan_mine2 = self end" OnCommand="x,-1000;z,10;basezoomx,-1;zoom,1/0.6;cullmode,none" />
			</children></Layer>
		</children></Layer>
		
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		<Layer Type="ActorFrame" OnCommand="%function(self) nyan_make_note(self) end"><children>
			<Layer File="arrow" OnCommand="%function(self) nyan_make_pastry(self) end"/>
			<Layer File="syrup" OnCommand="%function(self) nyan_make_icing(self) end"/>
		</children></Layer>
		
		<Layer File="_notehit" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nhit(self) end" />
		<Layer File="_notehit" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nhit(self) end" />
		<Layer File="_notehit" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nhit(self) end" />
		<Layer File="_notehit" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nhit(self) end" />
		<Layer File="_notehit" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nhit(self) end" />
		<Layer File="_notehit" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nhit(self) end" />
		<Layer File="_notehit" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nhit(self) end" />
		<Layer File="_notehit" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nhit(self) end" />
		
		<Layer File="arrow" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nded(self) end"/>
		<Layer File="arrow" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nded(self) end"/>
		<Layer File="arrow" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nded(self) end"/>
		<Layer File="arrow" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nded(self) end"/>
		<Layer File="arrow" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nded(self) end"/>
		<Layer File="arrow" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nded(self) end"/>
		<Layer File="arrow" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nded(self) end"/>
		<Layer File="arrow" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_nded(self) end"/>
		
		<Layer File="_arrowkun" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_ndk(self) end"/>
		<Layer File="_arrowkun" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_ndk(self) end"/>
		<Layer File="_arrowkun" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_ndk(self) end"/>
		<Layer File="_arrowkun" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_ndk(self) end"/>
		<Layer File="_arrowkun" OnCommand="hidden,1;animate,0;sleep,0.02;queuecommand,Make" HideCommand="hidden,1" MakeCommand="%function(self) nyan_make_ndk(self) end"/>
		
	</children></Layer>
	</children></Layer>
	
	<LAER Type="Quad" OnCommand="x,sw/2;y,sh/2;zoomto,sw,sh;cropright,0.4;faderight,0.5;diffuse,1,0,0,0"
	Fk_P1_W8MessageCommand="finishtweening;diffusealpha,.4;linear,0.3;diffusealpha,0;" />
	
	<LAER Type="Quad" OnCommand="x,sw/2;y,sh/2;zoomto,sw,sh;cropleft,0.4;fadeleft,0.5;diffuse,1,0,0,0"
	Fk_P2_W8MessageCommand="finishtweening;diffusealpha,.4;linear,0.3;diffusealpha,0;" />
	
	<CODE Type="Quad" OnCommand="hidden,1"
	StepP1LeftPressMessageCommand="%function(self) nyan_step(0) end"
	StepP1DownPressMessageCommand="%function(self) nyan_step(1) end"
	StepP1UpPressMessageCommand="%function(self) nyan_step(2) end"
	StepP1RightPressMessageCommand="%function(self) nyan_step(3) end"
	StepP2LeftPressMessageCommand="%function(self) nyan_step(0) end"
	StepP2DownPressMessageCommand="%function(self) nyan_step(1) end"
	StepP2UpPressMessageCommand="%function(self) nyan_step(2) end"
	StepP2RightPressMessageCommand="%function(self) nyan_step(3) end"
	/>
	
	<CODE Type="Quad" InitCommand="%function(self) nyan_beat_aux = self end" OnCommand="hidden,1;" />
	<CODE Type="Quad" InitCommand="%function(self) nyan_lean_aux = self end" OnCommand="hidden,1;" />
	<CODE Type="Quad" InitCommand="%function(self) nyan_blink_aux = self end" OnCommand="hidden,1;" />
	<CODE Type="Quad" InitCommand="%function(self) nyan_stealth_aux = self end" OnCommand="hidden,1;" />
	<CODE Type="Quad" InitCommand="%function(self) nyan_tiny_aux = self end" OnCommand="hidden,1;" />
	
	<Layer Type="ActorFrame" OnCommand="x,sw/2-112;y,sh/2-158;" ><children>
		<Layer Type="Quad" OnCommand="stretchto,-320,-240-480,320,-240;diffuse,0,0,0,0;" AlertMessageCommand="linear,1;diffusealpha,.6;sleep,1;linear,2;diffusealpha,0;" />
		<Layer Type="Quad" OnCommand="stretchto,-320,240,320,240+480;diffuse,0,0,0,0;" AlertMessageCommand="linear,1;diffusealpha,.6;sleep,1;linear,2;diffusealpha,0;" />
		<Layer Type="Quad" OnCommand="stretchto,-320-640,-240-480,-320,240+480;diffuse,0,0,0,0;" AlertMessageCommand="linear,1;diffusealpha,.6;sleep,2;linear,2;diffusealpha,0;" />
		<Layer Type="Quad" OnCommand="stretchto,320,-240-480,320+640,240+480;diffuse,0,0,0,0;" AlertMessageCommand="linear,1;diffusealpha,.6;sleep,1;linear,2;diffusealpha,0;" />
		<Layer File="important" OnCommand="diffusealpha,0;" AlertMessageCommand="linear,1;diffusealpha,.6;sleep,1;linear,2;diffusealpha,0;" />
	</children></Layer>
	
	<Layer Type="Quad" OnCommand="stretchto,0,0,sw,sh;diffuse,0,0,0,0;" FadeOutMessageCommand="linear,16*60/142;diffusealpha,1;" />
	
	<!--This is for the time based mod reader-->
	<BitmapText
		Font="Common Normal"
		Text="test"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;effectclock,music;playcommand,SetTime;hidden,1"
		SetTimeCommand="%function(self) self:settext(self:GetSecsIntoEffect()); mod_time = tonumber(self:GetText()); self:sleep(0.02); self:queuecommand('SetTime'); end"
	/>
	
	<Layer InitCommand="%function(self) nyan_intro_sky = self end" File="intro/sky" OnCommand="stretchto,0,0,sw,sh" />
	
	<Layer Type="ActorFrame" InitCommand="%function(self) nyan_intro_all = self end" OnCommand="x,sw/2;y,sh/2;" ><children>
		
		<Layer File="intro/grass" OnCommand="stretchto,-1.3*sw/2,-1.3*sh/2,1.3*sw/2,1.3*sh/2" />
		
		<Layer Type="ActorFrame" InitCommand="%function(self) nyan_intro_neko = self end" OnCommand="" ><children>
		<Layer File="intro/1" OnCommand="hidden,0;x,100;y,-30+224;vertalign,bottom;"
		Intro1MessageCommand="hidden,0;" Intro2MessageCommand="hidden,1;" Intro3MessageCommand="hidden,1;" />
		<Layer File="intro/2" OnCommand="hidden,1;x,100;y,-30+224;vertalign,bottom;"
		Intro1MessageCommand="hidden,1;" Intro2MessageCommand="hidden,0;" Intro3MessageCommand="hidden,1;" />
		<Layer File="intro/3" OnCommand="hidden,1;x,100;y,-30+224;vertalign,bottom;"
		Intro3MessageCommand="hidden,0;" Intro4MessageCommand="hidden,1;" />
		<Layer File="intro/4" OnCommand="hidden,1;x,100;y,-30+224;vertalign,bottom;"
		Intro4MessageCommand="hidden,0;zoomy,.9;addy,-4;sleep,.05;zoomy,1.05;addy,6;sleep,.05;zoomy,1;addy,-2;" Intro5MessageCommand="hidden,1;" />
		<Layer File="intro/5" OnCommand="hidden,1;x,100;y,-30+224;vertalign,bottom;"
		Intro5MessageCommand="hidden,0;zoomy,.9;addy,-4;sleep,.05;zoomy,1;addy,4;" Intro6MessageCommand="hidden,1;" />
		<Layer File="intro/6" OnCommand="hidden,1;x,100;y,-30+224;vertalign,bottom;"
		Intro6MessageCommand="hidden,0;zoomy,.9;addy,-4;sleep,.05;zoomy,1.05;addy,6;sleep,.05;zoomy,1;addy,-2;" Intro7MessageCommand="hidden,1;" />
		<Layer File="intro/7" OnCommand="hidden,1;x,100;y,-30+224;vertalign,bottom;"
		Intro7MessageCommand="hidden,0;" Intro8MessageCommand="hidden,1;" />
		<Layer File="intro/8" OnCommand="hidden,1;x,100;y,-30+224;vertalign,bottom;"
		Intro8MessageCommand="hidden,0;" Intro7MessageCommand="hidden,1;" />
		</children></Layer>
		
		<Layer Type="ActorFrame" InitCommand="%function(self) nyan_intro_candy = self end" OnCommand="x,-64-sw/2;y,-110-sh/2;zoom,1.5;" ><children>
			<Layer File="intro/poptart" OnCommand="vertalign,top;rotationz,4;" />
		</children></Layer>
		
		<Layer File="intro/question" InitCommand="%function(self) nyan_intro_question = self end" OnCommand="hidden,1;x,-30;y,-70;zoomy,0;rotationz,45;" />
		<Layer File="intro/thonk" InitCommand="%function(self) nyan_intro_thonk = self end"
		OnCommand="hidden,0;x,0;y,-60;diffusealpha,0;sleep,.3;linear,.4;diffusealpha,1;sleep,1.8;linear,.8;diffusealpha,0;" />
		
	</children></Layer>
	
	<Layer Type="Quad" OnCommand="stretchto,0,0,sw,sh;diffuse,0,0,0,1;linear,.1;diffusealpha,0;" />
	
</children></ActorFrame>