<Layer Type="ActorFrame" InitCommand="%function(self)

	--shit that's getting the succ
	yin_shit = {}
	yin_sptr = 1
	
	function yin_add_shit(obj)
		table.insert(yin_shit,obj)
	end
	
	mbc3_forced_winner = 0

end" ><children>

	<Layer File="canal_kick" />
	
	<CODE Type="Quad" InitCommand="hidden,1;sleep,9E9" OnCommand="%function(self)
	
		local function modulo(a, b)
			return a - math.floor(a/b)*b;
		end
		
		local function randomXD(t)
			if t == 0 then return 0.5 else
			return modulo(math.sin(t * 3229.3) * 43758.5453, 1) end
		end

		local function modtable_compare(a,b) return a[1] < b[1] end
		
		local function PrxD(pn)
			return _G['Proxy'..pn..'D']
		end
	
		local m,m2,me,l,e,str,mpf = mod_insert,mod_message,mod_ease,'len','end','',mpf_insert
		
		m2(1,function()
			
			--optimize shit
			for i=1,table.getn(mods) do
				local a = mods[i]
				
				local s = a[1]
				local e = a[2]
				if a[4] == 'len' then
					e = a[1]+a[2]
				end
				
				if s < 294 or e < 294 then
					table.insert(mods_dai,a)
				end
				if s >= 294 and s < 583.5 or e >= 294 and e < 583.5 or s < 294 and e >= 583.5 then
					table.insert(mods_hal,a)
				end
				if s >= 583.5 and s < 780 or e >= 583.5 and e < 780 or s < 583.5 and e >= 780 then
					table.insert(mods_tar,a)
				end
				if s >= 780 and s < 908.5 or e >= 780 and e < 908.5 or s < 780 and e >= 908.5 then
					table.insert(mods_tar2,a)
				end
				if s >= 908.5 or e >= 908.5 then
					table.insert(mods_finale,a)
				end
				
			end
			for i=1,table.getn(mods_ease) do
				local a = mods_ease[i]
				
				local s = a[1]
				local e = a[2]
				if a[6] == 'len' then
					e = a[1]+a[2]
				end
				
				if s < 294 or e < 294 then
					table.insert(mods_ease_dai,a)
				end
				if s >= 294 and s < 583.5 or e >= 294 and e < 583.5 or s < 294 and e >= 583.5 then
					table.insert(mods_ease_hal,a)
				end
				if s >= 583.5 and s < 780 or e >= 583.5 and e < 780 or s < 583.5 and e >= 780 then
					table.insert(mods_ease_tar,a)
				end
				if s >= 780 and s < 908.5 or e >= 780 and e < 908.5 or s < 780 and e >= 908.5 then
					table.insert(mods_ease_tar2,a)
				end
				if s >= 908.5 or e >= 908.5 then
					table.insert(mods_ease_finale,a)
				end
				
			end
			for i=1,table.getn(mod_mpf) do
				local a = mod_mpf[i]
				if a[1] < 294 or a[2] < 294 then
					table.insert(mod_mpf_dai,a)
				end
				if a[1] >= 294 and a[1] < 583.5 or a[2] >= 294 and a[2] < 583.5 or a[1] < 294 and a[2] >= 583.5 then
					table.insert(mod_mpf_hal,a)
				end
				if a[1] >= 583.5 and a[1] < 780 or a[2] >= 583.5 and a[2] < 780 or a[1] < 583.5 and a[2] >= 780 then
					table.insert(mod_mpf_tar,a)
				end
				if a[1] >= 780 and a[1] < 908.5 or a[2] >= 780 and a[2] < 908.5 or a[1] < 780 and a[2] >= 908.5 then
					table.insert(mod_mpf_tar2,a)
				end
				if a[1] >= 908.5 or a[2] >= 908.5 then
					table.insert(mod_mpf_finale,a)
				end
			end
			
		end,true)
		
		--custom framerate
		m2(44,function()
			custom_framerate = 80
		end,true)
		m2(382,function()
			custom_framerate = 50
		end,true)
		m2(398,function()
			custom_framerate = 80
		end,true)
		m2(715.5,function()
			custom_framerate = 70
		end,true)
		m2(780,function()
			custom_framerate = 80
		end,true)
		m2(808,function()
			custom_framerate = 70
		end,true)
		m2(908,function()
			custom_framerate = 80
		end,true)
		
		
		
		
		
		
		
		
		m2(908,function()
			
			yin_templebgcover:finishtweening()
			yin_templebgcover:linear(240/185)
			yin_templebgcover:diffusealpha(1)
			
		end,true)
		
		m2(912,function()
			
			yin_temple:hidden(1)
			yin_waterfall:hidden(1)
			yin_templebgcover:hidden(1)
			
		end,true)
		
		local function mb(s)
			MESSAGEMAN:Broadcast(s)
		end
		
		--[[
		m2(912,function()
			finale_light:hidden(0)
			finale_light:diffusealpha(0)
			finale_light:linear(240/185)
			finale_light:diffusealpha(.8)
			finale_light:sleep(240/185)
			finale_light:linear(16*60/185)
			finale_light:diffusealpha(0)
			
			mb('Text1On')
		end)
		]]
		
		if slumpo then
			
			m2(925,function()
			
				char_yin3:basezoomx(.6)
				char_yin3:basezoomy(.6)
				char_yin3:x(SCREEN_CENTER_X);
				char_yin3:y(SCREEN_CENTER_Y);
				char_yin3:playcommand('Spawn')
				char_yin3:playcommand('Pised')
				
			end)
			m2(936,function()
				
				char_yin3:playcommand('Hurt')
				char_yin3:rotationy(360)
				char_yin3:tween(240/185,'outExpo(%f,0,1,1)')
				char_yin3:rotationy(0)
				
			end)
			m2(942,function()
				
				char_yin3:playcommand('Hide')
				
			end)
			
			
			m2(925,function()
				mb('Text2On')
				taro_Sound('Finale/yin_ex voice1')
			end)
			m2(936,function()
				mb('Text3On')
				taro_Sound('Finale/wave')
			end)
			
		end
		
		
		mpf(912,1500,function(beat,deltatime)
		
			local t = GAMESTATE:GetSongTime()
		
			local offs = (t)/32
			local offs2 = (t)/4
			
			for w=1,4 do
				local a = _G['yin_temple2_wall'..w]
				if a then
					a:zoomz(8)
					a:customtexturerect(0-offs,0,2-offs,1)
				end
			end
			for w=1,4 do
				local a = _G['yin_temple2_floor'..w]
				if a then
					a:zoomz(8)
					a:customtexturerect(0,0-offs,.75,2-offs)
				end
			end
			
			yin_temple2_stream:zoomz(8)
			yin_temple2_stream:customtexturerect(0,0-(offs+offs2)*-2,1,2-(offs+offs2)*-2)
			yin_temple2_stream:rotationx(-95+10*math.sin(beat*math.pi*0.25))
			
		end)
		
		m2(912,function()
			yin_temple2:hidden(0)
			yin_temple2bgcover:hidden(0)
			yin_temple2bgcover:diffusealpha(1)
			yin_temple2bgcover:linear(4*60/185)
			yin_temple2bgcover:diffusealpha(0)
			h_clouds:hidden(0)
			h_clouds:diffusealpha(1)
		end,true)
		
		m2(912,function()
			
			for pn=1,4 do
				local a = Plr(pn)
				if a then
				
					a:ResetXSplines()
					a:ResetYSplines()
					a:ResetSizeSplines()
				
					a:hidden(1)
					a:x(sw/2)
					a:rotationy(0)
					a:y(sh/2)
					a:zoom(1)
					a:z(-200*pn)
					a:zoomz(1)
					--Trace(a:GetX())
					--Trace(tostring(a))
					
					a:fov(60)
					
					
					for c = 0,3 do
						a:SetNumArrowGradientPoints(c,2)
						--Player:SetArrowGradientColor(point,column,r,g,b,a)
						a:SetArrowGradientColor(0,c,1,1,1,1)
						a:SetArrowGradientColor(1,c,1,1,1,1)
					end
					
				end
				local a = PrxD(pn)
				if a then
					a:hidden(0)
					--Trace(tostring(a))
				end
			end
			
		end,true)
		
		for pn=3,4 do
			m(912,1,'*-1 no bumpy, *-1 no rotationx, *-1 no zigzagz',l,pn)
		end
		
		m(912,9999,'*-1 zbuffer, *-1 stealthpastreceptors',e)
		
		m(912,952,'*-1 reverse, *-1 1.75x',e)
		
		local pr = 0
		local pr2 = 2
		for i=1,table.getn(canal_kick) do
			
			local a = canal_kick[i]
			if a[2] == 0 then
				me(a[1],1.5,50,0,'stealth',l,outCubic,pr+1)
				me(a[1],1.5,50,0,'stealth',l,outCubic,pr2+1)
				pr = math.mod(pr+1,4)
				pr2 = math.mod(pr2+1,4)
			elseif a[2] == 1 then
				me(a[1],.5,-200,0,'noteskew',l,outCubic)
			elseif a[2] == 2 then
				me(a[1],.5,200,0,'noteskew',l,outCubic)
			elseif a[2] == 3 then
				me(a[1],1.5,-400,0,'tinyy',l,outCubic)
			end
			
		end
		
		
		mpf(912,952,function(beat)
		
			for pn=1,4 do
				
				local a = Plr(pn)
				if a then
					
					local zp = 1000 - math.mod( (beat-912)*250 + pn*1000, 4000 )
					
					a:z(zp)
					
					local al = 1
					if zp < -1000 then
						al = 1+(zp+1000)/1000
					end
					if al < 0 then al = 0 end
					
					if al < 1 then
						for c = 0,3 do
							a:SetNumArrowGradientPoints(c,2)
							--Player:SetArrowGradientColor(point,column,r,g,b,a)
							a:SetArrowGradientColor(0,c,1,1,1,al/2)
							a:SetArrowGradientColor(1,c,1,1,1,al/2)
						end
						mod_do('*-1 '..100*(1-al)..' dark',pn)
					else
						for c = 0,3 do
							a:SetNumArrowGradientPoints(c,2)
							--Player:SetArrowGradientColor(point,column,r,g,b,a)
							a:SetArrowGradientColor(0,c,1,1,1,1)
							a:SetArrowGradientColor(1,c,1,1,1,1)
						end
						mod_do('*-1 no dark',pn)
					end
					
				end
				
			end
			
			local amp = 1
			if beat > 948 and beat < 952 then
				amp = 1-inQuad((beat-948),0,1,4)
			end
			
			local stuff = {finale_prxdc,yin_temple2}
			local ry = amp*10*math.sin(beat*math.pi*.0625)
			
			--local rz = (beat-912)*(360/32)
			
			for i=1,2 do
				stuff[i]:rotationy2(ry)
				--stuff[i]:rotationz(rz)
			end
			
			
			local str = '*-1 -130 confusionxoffset, *-1 50 roll, *-1 sudden, *-1 100 suddenoffset, *-1 hidden, *-1 -100 hiddenoffset, *-1 -500 attenuatez, *-1 500 attenuate, *-1 40 y,'
			for i=0,3 do
				str = str..'*-1 '..(-400*i)..' movez'..i..','
			end
			
			--str = str..'*-1 '..(-100*math.rad(rz))..' confusionoffset'
			
			mod_do(str)
			
			
			
		end)
		
		
		for pn=1,4 do
			local d = math.mod(pn,2)*2 - 1
			
			me(924,2,0,100*d,'drunk',l,outCubic,pn,2)
			me(928,1,100*d,-100*d,'drunk',l,outCubic,pn,2)
			me(929.5,1,-100*d,100*d,'drunk',l,outCubic,pn,2)
			me(930.666,1,100*d,-100*d,'drunk',l,outCubic,pn,2)
			me(932,2,-100*d,100*d,'drunk',l,outCubic,pn,2)
			me(936,1,100*d,-100*d,'drunk',l,outCubic,pn,2)
			me(937.5,1,-100*d,100*d,'drunk',l,outCubic,pn,2)
			me(938.666,1,100*d,-100*d,'drunk',l,outCubic,pn,2)
			me(940,8,-100*d,0,'drunk',l,outElastic,pn)
			
		end
		
		for i=0,3 do
			me(952,1,(-400*(i)),0,'movez'..(i),l,outCubic)
		end
		
		me(948-.05,.333,0,100,'invert',l,outExpo)
		me(948.333-.05,.333,100,0,'invert',l,outExpo)
		me(948.666-.05,.333,0,100,'invert',l,outExpo)
		me(949-.05,.333,100,0,'invert',l,outExpo)
		
		me(950-.05,.333,0,100,'invert',l,outExpo)
		me(950.333-.05,.333,100,0,'invert',l,outExpo)
		me(950.666-.05,.333,0,100,'invert',l,outExpo)
		me(951-.05,.333,100,0,'invert',l,outExpo)
		
		for i=0,3 do
			me(948-.05+.333*i,.333,-200,0,'tinyx',l,outCubic)
			me(950-.05+.333*i,.333,-200,0,'tinyx',l,outCubic)
		end
		
		m2(952,function()
			
			local stuff = {finale_prxdc,yin_temple2}
			for i=1,2 do
				stuff[i]:rotationz(-360)
				stuff[i]:tween(5,'outBack(%f,0,1,1)')
				stuff[i]:rotationz(0)
			end
			
			for pn=1,4 do
				local a = Plr(pn)
				if a then
					a:tween(2,'outCubic(%f,0,1,1)')
					a:z(0)
					
					for c = 0,3 do
						a:SetNumArrowGradientPoints(c,2)
						--Player:SetArrowGradientColor(point,column,r,g,b,a)
						a:SetArrowGradientColor(0,c,1,1,1,1)
						a:SetArrowGradientColor(1,c,1,1,1,1)
					end
					
				end
			end
			
		end)
		
		me(952,1,100,0,'reverse',l,outCubic)
		
		--simple_m0d2(952-.1,-500,3,'tiny')
		me(952-.1,.1,0,-800,'tiny',l,outCubic)
		me(952,1,-800,0,'tiny',l,inOutCubic)
		
		me(952,1,-500,0,'attenuatez',l,outCubic)
		me(952,1,500,0,'attenuate',l,outCubic)
		me(952,1,500,100,'tornado',l,outCubic)
		
		me(953,16,100,0,'tornado',l,inElastic,nil,1)
		me(953,16,360*8,0,'rotationx',l,inOutCubic)
		me(953,16,-(200*math.pi)*8,0,'confusionxoffset',l,inOutCubic)
		
		me(953,8,100,200,'zoom',l,inOutCubic)
		me(959,8,200,100,'zoom',l,inOutCubic)
		me(953,8,100,200,'zoomz',l,inOutCubic)
		me(959,8,200,100,'zoomz',l,inOutCubic)
		me(953,8,0,-200,'tiny',l,inOutCubic)
		me(959,8,-200,0,'tiny',l,inOutCubic)
		me(953,8,0,-200,'tinyz',l,inOutCubic)
		me(959,8,-200,0,'tinyz',l,inOutCubic)
		
		m(966.5,3,'*-1 500 beat',l)
		m(969.6,1,'*-1 no beat',l)
		
		me(967,1,-300,0,'tiny',l,outCubic)
		me(968,1,-300,0,'tiny',l,outCubic)
		
		me(967,1,0,100,'flip',l,outCubic)
		me(968,1,100,0,'flip',l,outCubic)
		me(968,1,0,100,'invert',l,outCubic)
		me(969,1,100,0,'invert',l,outCubic)
		
		m2(977,function()
			mb('Text5On')
			taro_Sound('Finale/yin_ex voice2')
		end)
		
		m2(977,function()
			
			char_yin3:basezoomx(.6)
			char_yin3:basezoomy(.6)
			char_yin3:x(SCREEN_CENTER_X);
			char_yin3:y(SCREEN_CENTER_Y);
			char_yin3:playcommand('Spawn')
			char_yin3:playcommand('Pised')
			
		end,true)
		
		m2(984,function()
			
			char_yin3:decelerate(1)
			char_yin3:addy(-10);
			char_yin3:playcommand('Genki')
			
			yin_hat:hidden(0)
			yin_hat:zoom(0)
			yin_hat:rotationx(180)
			yin_hat:bounceend(.6)
			yin_hat:zoom(1)
			yin_hat:GetChild(''):rotationy(720)
			yin_hat:GetChild(''):tween(.6,'outQuad(%f,0,1,1)')
			yin_hat:GetChild(''):rotationy(0)
			yin_hat:GetChild(''):GetChild(''):tween(.6,'inOutQuad(%f,0,1,1)')
			yin_hat:GetChild(''):GetChild(''):rotationz(0)
			
		end,true)
		
		m2(988,function()
			
			char_yin3:addy(50);
			char_yin3:decelerate(.5)
			char_yin3:addy(-40)
			char_yin3:playcommand('DropHat')
			
			char_yin3:sleep(.5)
			char_yin3:tween(240/190,'inOutQuad(%f,0,1,1)')
			char_yin3:addy(-40)
			char_yin3:zoom(.8)
			
			yin_hat:sleep(0)
			yin_hat:diffusealpha(1)
			yin_hat:y(sh/2+40)
			yin_hat:tween(.6,'outExpo(%f,0,1,1)')
			yin_hat:y(sh*0.7 + 40)
			yin_hat:rotationx(180+30)
			yin_hat:rotationy(180)
			
		end)
		
		m2(988,function()
			
			yin3_hatdrop:hidden(0)
			yin3_hatdrop:diffusealpha(.6)
			yin3_hatdrop:xy(sw/2,sh/2+40)
			yin3_hatdrop:zoom(.6)
			yin3_hatdrop:sleep(.1)
			yin3_hatdrop:linear(.2)
			yin3_hatdrop:diffusealpha(0)
			yin3_hatdrop:queuecommand('Hide')
			
		end)
		
		m2(990,function()
			
			yin_holepre:tween(.6,'outElastic(%f,0,1,1)')
			yin_holepre:zoom(.4)
			yin_holepre:diffusealpha(.5)
			
		end)
		
		mod_wiggle(953,4*12,4,200,2,'tipsy')
		
		
		
		
		m2(967,function()
		
			yin_temple2:tween(240/190,'inCubic(%f,0,1,1)')
			yin_temple2:addy(1800)
			yin_temple2:queuecommand('Hide')
			
		end)
		
		m2(973,function()
			
			yin_temple2:addy(1800)
			yin_temple2:hidden(1)
			
		end,true)
		
		
		
		
		
		
		m2(969,function()
			
			finale_aux2:tween(240/190,'outCubic(%f,0,1,1)')
			finale_aux2:x(1)
			
		end)
		m2(997,function()
			
			finale_aux2:tween(240/190,'inCubic(%f,0,1,1)')
			finale_aux2:x(0)
			
			
		end)
		
		m2(969,function()
			
			
			for i=0,3 do
				_G['finale_auxT_'..i+1]:x(0)
				_G['finale_auxT_'..i+1]:sleep(i*2*60/190)
				_G['finale_auxT_'..i+1]:tween(480/190,'inOutCubic(%f,0,1,1)')
				_G['finale_auxT_'..i+1]:x(360)
				_G['finale_auxT_'..i+1]:sleep(0/190)
				_G['finale_auxT_'..i+1]:tween(480/190,'inOutCubic(%f,0,1,1)')
				_G['finale_auxT_'..i+1]:x(0)
				_G['finale_auxT_'..i+1]:sleep(0/190)
				_G['finale_auxT_'..i+1]:tween(480/190,'inOutCubic(%f,0,1,1)')
				_G['finale_auxT_'..i+1]:x(360)
				_G['finale_auxT_'..i+1]:sleep(0/190)
				_G['finale_auxT_'..i+1]:tween(480/190,'inOutCubic(%f,0,1,1)')
				_G['finale_auxT_'..i+1]:x(0)
			end
			
		end)
		
		m2(971,function()
			
			finale_aux:x(0)
			finale_aux:tween(240/190,'inOutCubic(%f,0,1,1)')
			finale_aux:x(360)
			finale_aux:tween(240/190,'inOutCubic(%f,0,1,1)')
			finale_aux:x(0)
			finale_aux:tween(240/190,'inOutCubic(%f,0,1,1)')
			finale_aux:x(360)
			finale_aux:tween(240/190,'inOutCubic(%f,0,1,1)')
			finale_aux:x(0)
			finale_aux:tween(240/190,'inOutCubic(%f,0,1,1)')
			finale_aux:x(360)
			finale_aux:tween(240/190,'inOutCubic(%f,0,1,1)')
			finale_aux:x(0)
			finale_aux:tween(240/190,'inOutCubic(%f,0,1,1)')
			finale_aux:x(360)
			finale_aux:tween(240/190,'inOutCubic(%f,0,1,1)')
			finale_aux:x(0)
			
			
		end)
		
		
		for i=0,1 do
		
			me(985+8*i,1.5,-300,0,'tiny',l,outQuad)
			me(986.5+8*i,1.5,-300,0,'tiny',l,outQuad)
			me(988+8*i,1.5,-300,0,'tiny',l,outQuad)
			me(989.5+8*i,1.5,300,0,'tipsy',l,outQuad)
			me(991+8*i,1.5,-300,0,'tipsy',l,outQuad)
			me(992+8*i,1.5,300,0,'tipsy',l,outQuad)
			
			m2(985+8*i,1,60,0,'brake',l,outQuad)
			m2(986.5+8*i,1,60,0,'brake',l,outQuad)
			m2(988+8*i,1,60,0,'brake',l,outQuad)
			m2(989.5+8*i,1,60,0,'brake',l,outQuad)
			m2(991+8*i,1,60,0,'brake',l,outQuad)
			m2(992+8*i,1,60,0,'brake',l,outQuad)
			
		end
		
		me(1003,.75,0,80,'drunk',l,outCubic)
		me(1003.75,.75,80,-80,'drunk',l,outCubic)
		mod_wiggle(1004.5,4*12.5,4,-80,2,'drunk',nil,true)
		m(1003,1017,'50 bumpy',e)
		
		me(969,973,0,100,'wave',e,outCubic,nil,997)
		me(997,4,100,0,'wave',e,inOutCubic)
		me(969,973,0,50,'drunk',e,outCubic,nil,997)
		me(997,4,50,0,'drunk',e,inOutCubic)
		me(969,973,0,100,'sudden',e,outCubic,nil,997)
		me(997,4,100,0,'sudden',e,inOutCubic)
		
		m(969,1000,'*-1 150 suddenoffset',e)
		
		for pn=1,4 do
			m(968.5,1000.5,'*-1 '..(100*math.mod(pn,2)*2-1)..' beat',e,pn)
		end
		
		m(1000.5,1,'*-1 no beat',l)
		
		mpf(969,1001,function(beat)
			
			for pn=1,4 do
				
				local ang = (beat-969)*math.pi*0.125 + (pn-1)*math.pi*0.5
				
				local a = Plr(pn)
				if a then
					
					a:x( scx+200*math.sin(ang)*finale_aux2:GetX() )
					a:z( (-200+200*math.cos(ang))*finale_aux2:GetX() )
					a:rotationz( 30*math.sin(ang)*finale_aux2:GetX() + _G['finale_auxT_'..pn]:GetX()*(math.mod(pn,2)*2-1) )
					
				end
				
				local a = PrxD(pn)
				if a then
					a:z( (1*math.cos(ang))*finale_aux2:GetX() )
				end
				
				mod_do('*-1 '..(-100*math.rad(30)*math.sin(ang)*finale_aux2:GetX())..' confusionoffset, *-1 '..(300*finale_aux2:GetX()*math.sin(ang))
						..' parabolax, *-1 '..(500*finale_aux2:GetX()*math.sin(ang))..' parabolaz',pn)
				
			end
			
		end)
		
		
		
		
		m2(1001,function()
			for pn=1,2 do
				local a = Plr(pn)
				if a then
					a:fov(60)
					a:x(sw/2)
					a:y(sh/2)
					a:zoom(1)
					a:rotationz(0)
				end
			end
			
			for pn=3,4 do
				local a = PrxD(pn)
				if a then
					a:hidden(1)
				end
			end
		end,true)
		
		function toss(pn,pos,which,spd)
		
			local beat = GAMESTATE:GetSongBeat()
		
			local rzm = 1+3*inCubic(beat-1001,0,1,29)
			if which == 9 then
				rzm = 1
			end
			
			local bobm = 0
			if beat >=1001 and beat < 1017 then
				bobm = linear(beat-1001,0,1,16)
			else
				bobm = 1
			end
			
			local rz = rzm*30*(pn*2-3) - rzm*60*(pn*2-3)*inQuad(pos,0,1,1)
			local rx = 10 - 60*inExpo(pos,0,1,1)
			local x = (200*(pn*2-3)) - ((150+100*randomXD(which))*(pn*2-3))*linear(pos,0,1,1) + 32*math.sin(beat*2*math.pi)*bobm
			local y = (80*(pn*2-3)) - (160*randomXD(which+100)*(pn*2-3))*linear(pos,0,1,1)
			local z = -1000*inQuad(pos,0,1,1)
			
			local zoomy = 100 + 100*outQuad(beat-1001,0,1,29)
			local zoomz = 100 + 250*linear(beat-1001,0,1,29)
			
			local zoomx = 0
			if pos >= 0 and pos < .5 then
				zoomx = 100*outElastic(pos,0,1,.5)
			elseif pos >= .5 and pos < 1 then
				zoomx = 100 - 100*inCubic(pos-.5,0,1,.5)
			end
			local centered = 0
			if pos >= 0 and pos < .25 then
				centered = 200 - 200*outQuad(pos,0,1,.25)
			elseif pos >= .25 and pos < 1 then
				centered = 300*inExpo(pos-.25,0,1,.75)
			end
			
			local hallway = 150*inQuad(pos,0,1,1)*spd
			
			if pn == 1 and which <= 9 or pn == 2 and which <= 9 then
				mod_do('*10000 '..rz..' rotationz, *10000 '..rx..' rotationx, *10000 '..x..' x, *10000 '..z..' z, *10000 '..zoomx..' zoomx, *10000 '..y..' y,'
				..'*10000 '..hallway..' hallway, *10000 '..centered..' centered, *10000 '..zoomy..' zoomy, *10000 '..zoomz..' zoomz',pn)
			else
				local a = PrxD(pn)
				if a then
					a:hidden(1)
				end
			end
			
		end
		
		for pn=3,4 do
			for i=0,3 do
				m(912,1,'*10000 no confusionoffset'..i..',*10000 no confusionxoffset'..i..',*10000 no confusionyoffset'..i,l,pn)
			end
		end
		
		yin_tosspos = 0
		
		m2(1001,'WhiteFlash')
		m2(1001,'VortexSpin',true)
		m2(1001,'Perspective',true)
		
		m2(1001,function()
			taro_Sound('Finale/hole')
		end)
		
		mpf(1001,1035,function(beat,deltatime)
		
			local tossmult = 0.3
			if beat >= 1001 and beat < 1009 then
				tossmult = 0.3+1.2*linear(beat-1001,0,1,8)
			elseif beat >= 1009 and beat < 1013 then
				tossmult = 1.5
			elseif beat >= 1013 and beat < 1017 then
				tossmult = 1.5-0.6*linear(beat-1013,0,1,4)
			else
				tossmult = 0.9
			end
			
			yin_tosspos = yin_tosspos+deltatime*tossmult
			
			for pn=1,2 do
				
				local pos = yin_tosspos
				if pn == 2 then pos = pos+0.5 end
				local which = math.floor(pos)
				pos = pos-math.floor(pos)
				
				local a = Plr(pn)
				if a then
					toss(pn,pos,which,tossmult)
				end
			end
			
		end)
		
		yin_succtimer = 0
		yin_succdelay = 0.5
		
		if slumpo then
			yin_succdelay = 0.3
		end
		
		function cos_jump(pos)
			--0 = cos(-pi/2)
			--1 = cos(pi/2)
			return math.cos(-0.5*math.pi + pos*math.pi)
		end
		
		--here comes T H E S U C C
		mpf(1003,1060,function(beat, deltatime)
		
			if yin_succtimer <= 0 then
				if yin_sptr <= table.getn(yin_shit) then
					local a = yin_shit[yin_sptr]
					
					if a then
						a:aux(0)
					end
					
					yin_sptr = yin_sptr+1
				end
				yin_succtimer = yin_succdelay
			else
				yin_succtimer = yin_succtimer-deltatime
			end
			
			for i=1,table.getn(yin_shit) do
				
				local a = yin_shit[i]
				if a and a:getaux() >= 0 then
				
					if a:getaux() == 0 then --setup
						Trace('throw item '..i)
					end
					
					a:hidden(0)
					a:aux( a:getaux() + deltatime )
					
					local pos = a:getaux()
					
					a:zoomy( (1 + 3*inQuart(pos,0,1,1))*(1-inQuad(pos,0,1,1)) )
					a:zoomx( (1 - inExpo(pos,0,1,1))*(1-inQuad(pos,0,1,1)) )
					
					local rngx = sw*0.1 + sw*0.8*randomXD(i)
					local rngx2 = sw*0.5 - 50 + 100*randomXD(i+100)
					local rngy = sh*0.6 - 40 + 80*randomXD(i+200)
					local rngr = 360*randomXD(i+300)
					local rngr2 = 360*randomXD(i+400)
					local rngr3 = -20 + 40*randomXD(i+400)
					
					local b = a:GetChild('')
					
					if b then
						if b:getaux() == 2 then
							b:rotationx(rngr2 + pos*360)
						end
						if b:getaux() > 0 then
							b:rotationz(rngr + pos*360)
							b:diffusealpha(.8)
						end
						if b:getaux() == 0 then
							b:rotationz(rngr3*(1-pos*2))
						end
					end
					
					a:x( rngx + (rngx2 - rngx)*pos )
					a:y( (sh+40) + (rngy - (sh+40))*pos - 120*cos_jump(pos) )
					
					if a:getaux() >= 1 then
						a:hidden(1)
						a:aux(-1)
					end
					
				end
				
			end
			
		end)
		
		m2(1031,function()
			
			for pn=3,4 do
				local a = Plr(pn)
				if a then
					a:hidden(1)
					a:rotationz(0)
					a:z(0)
					a:zoom(0)
					a:tween(240/190,'outElastic(%f,0,1,1)')
					a:zoom(1)
					a:xy(sw/2,sh/2)
					for c = 0,3 do
						a:SetNumArrowGradientPoints(c,0)
					end
				end
				local a = PrxD(pn)
				if a then
					a:hidden(0)
					a:z(1)
				end
			end
			
		end,true)
		
		mpf(1031,1081,function(beat)
			
			for pn=3,4 do
			
				local pna = pn-2
			
				local mul = 1+1*linear(beat-1032,0,1,49)
				
				local mul2 = 1
				if beat >= 1076.5 and beat < 1080.5 then
					mul2 = 1-inExpo(beat-1076.5,0,1,4)
				elseif beat >= 1080.5 then
					mul2 = 0
				end
				
				local rotationz = (mul-1)*10*math.cos(beat*0.25*math.pi)*(pna*2-3)
				local skx = (mul-1)*200*math.cos(beat*0.25*math.pi)*(pna*2-3)
				local x = -80*math.sin(beat*0.25*math.pi)*(pna*2-3)
				local y = 10-40*math.sin(beat*0.5*math.pi)*(pna*2-3) + 30*math.sin(beat*0.1*math.pi) + 100*(1-mul2)
				local z = (mul*50*math.cos(beat*0.5*math.pi)*(pna*2-3) + 100*linear(beat-1032,0,1,49))
				local hallway = 50 + 100*linear(beat-1032,0,1,49)
				local zoomz = 100 + 100*linear(beat-1032,0,1,49)
				local zoomy = (100 + 300*linear(beat-1032,0,1,49) + (mul-1)*20*math.cos(beat*0.5*math.pi)*(pna*2-3))*mul2
				
				mod_do('*10000 '..skx..' skewx, *10000 '..x..' x, *10000 '..y..' y, *10000 '..z..' z, *10000 bumpy, *10000 500 bumpyperiod,'
				..'*10000 '..hallway..' hallway, *10000 '..zoomy..' zoomy, *10000 '..zoomz..' zoomz, *1000 sudden, *1000 20 suddenoffset, *10000 1.1x',pn)
				
				if beat > 1035 then
					local yvib = 10*math.sin(beat*math.pi*16)*linear(beat-1035,0,1,45)
					local a = Plr(pn)
					if a then
						a:y(sh/2 + yvib)
					end
				end
				
			end
			
		end)
		
		me(1063.5,1079,0,50,'reverse',e,outInQuad,nil,8)
		me(1071.5,9,0,100,'tinyy',l,linear,nil,8)
		me(1079.5,1,50,100,'dark',l,linear,nil,2)
		m2(1080.5,function()
			for pn=1,4 do
				local a = PrxD(pn)
				if a then
					a:hidden(1)
				end
			end
		end,true)
		
		function orchit(b,d)
			simple_m0d2(b-.1,150*d,.4,'drunk')
			simple_m0d2(b-.1,150,.4,'tipsy')
		end
		
		orchit(1033,1)
		orchit(1034.5,-1)
		orchit(1036,1)
		orchit(1037.5,-1)
		orchit(1038.5,1)
		orchit(1039.5,-1)
		
		for i=1053,1061 do
			me(i,.25,50,0,'stealth0',l,linear,3)
			me(i,.25,50,0,'stealth1',l,linear,3)
			me(i+.25,.25,50,0,'stealth2',l,linear,4)
			me(i+.25,.25,50,0,'stealth3',l,linear,4)
			me(i+.5,.25,50,0,'stealth2',l,linear,3)
			me(i+.5,.25,50,0,'stealth3',l,linear,3)
			me(i+.75,.25,50,0,'stealth0',l,linear,4)
			me(i+.75,.25,50,0,'stealth1',l,linear,4)
		end
		
		--switcheroo_add(beat,which,speed,len,pn)
		switcheroo_add(1033-.1,'dlru',10,1.5)
		switcheroo_add(1034.5-.1,'flip',10,1.5)
		switcheroo_add(1036-.1,'urld',10,1.5)
		
		switcheroo_add(1037.5-.1,'flip',10,1.5)
		switcheroo_add(1038.5-.1,'dlru',10,1.5)
		switcheroo_add(1039.5-.1,'ldur',10,1.5)
		
		mod_wiggle(1041,3,4,200,2,'drunk')
		mod_wiggle(1042,4,2,200,1,'tipsy')
		mod_wiggle(1044,3,4,200,2,'drunk')
		mod_wiggle(1045,4,2,200,1,'tipsy')
		mod_wiggle(1047,3,4,200,2,'drunk')
		
		me(1049,4,360,0,'rotationy',l,inOutCubic)
		me(1049,4,-200*math.pi,0,'confusionyoffset',l,inOutCubic)
		
		m(1076,1200,'*10000 hidemines, *10000 disablemines',e)
		
		
		m(1062-.1,1.5,'*10 invert',l)
		m(1063.5-.1,1.5,'*10 no invert',l)
		
		
		m2(1063.5,function()
			
			char_yin3:playcommand('HideQ')
			
			yin_final_hurt:hidden(0)
			yin_final_hurt:tween(1,'outCubic(%f,0,1,1)')
			yin_final_hurt:addy(-100)
			yin_final_hurt:tween(1,'inExpo(%f,0,1,1)')
			yin_final_hurt:addy(100)
			yin_final_hurt:playcommand('Spin')
			yin_final_hurt:playcommand('Descend')
			
			judgment_proxies:hidden(1)
			
		end)
		m2(1063.5,'WhiteFlash')
		
		m2(1080.25,'FinalBlip')
		
		m2(1001,function()
			MESSAGEMAN:Broadcast('ShowFinalAFT')
			final_aft_sprite:stretchto(0,0,sw,sh)
		end,true)
		
		m2(1071.5,function()
			
			final_aft_sprite:tween(510/190,'inExpo(%f,0,1,1)')
			final_aft_sprite:rotationz(180)
			final_aft_sprite:zoom(0)
			final_aft_sprite:xy(sw/2,sh*0.55)
			
		end)
		
		mpf(1001,1081,function(beat)
			
			local mag = inQuad(beat-1001,0,8,80)
			
			final_aft_sprite:vibrate()
			final_aft_sprite:effectmagnitude(mag,mag,0)
			
			local warp = 0
			
			if beat >= 1001 and beat < 1033 then
				warp = -0.25*linear(beat-1001,0,1,32)
			elseif beat >= 1033 and beat < 1053 then
				warp = -0.25-0.5*linear(beat-1033,0,1,20)
			elseif beat >= 1053 and beat < 1080.5 then
				warp = -.75-.75*linear(beat-1053,0,1,27.5)
			elseif beat >= 1080.5 then
				warp = -1.5
			end
			
			warp_aft_sprite:GetShader():uniform1f('amt',warp)
			
		end)
		
		
		
		--handle score gfx stuff
		
		--[[
		m2(952,function()
		
			local spb = 60/190
			
			score_container:hidden(0)
			
			for pn=1,2 do
				
				local a = _G['hexmaskA'..pn]
				a:xy( sw/2 + 160*(pn*2-3), sh/2 - 128 )
				a:tween(spb,'outBack(%f,0,1,1)')
				a:zoom(1)
				
				local a = _G['hexholderA'..pn]
				a:xy( sw/2 + 160*(pn*2-3), sh/2 - 128 )
				a:tween(spb,'outBack(%f,0,1,1)')
				a:zoom(1)
				
				local a = _G['numbersA'..pn]
				a:xy( sw/2 + 160*(pn*2-3), sh/2 - 128 )
				a:tween(spb,'outBack(%f,0,1,1)')
				a:zoom(1)
				
				local a = _G['winsA'..pn]
				a:zoom(.8)
				a:xy( sw/2 + 160*(pn*2-3), sh/2 - 128 + 10 )
				a:sleep(spb)
				a:tween(spb,'linear(%f,0,1,1)')
				a:diffusealpha(1)
				
			end
			
		end)
		
		m2(953,function()
			
			
			local spb = 60/190
			
			for i=1,5 do
			
				local oe = (math.mod((i-1),2)+1)*2-3
				
				local a = _G['hexmask'..i]
				a:sleep(spb*(i-1))
				a:xy( sw/2 + 10*oe, sh/2 - 20 + 56*(i-1) )
				a:tween(spb,'outCubic(%f,0,1,1)')
				a:zoom(.5)
				a:sleep(spb*6)
				a:tween(spb,'inOutExpo(%f,0,1,1)')
				a:x( sw/2 + 10*oe + 160*(mbc3_tier4_winner[i]*2-3))
				
				local a = _G['hexholder'..i]
				a:sleep(spb*(i-1))
				a:xy( sw/2 + 10*oe, sh/2 - 20 + 56*(i-1) )
				a:tween(spb,'outCubic(%f,0,1,1)')
				a:zoom(.5)
				a:sleep(spb*6)
				a:tween(spb,'inOutExpo(%f,0,1,1)')
				a:x( sw/2 + 10*oe + 160*(mbc3_tier4_winner[i]*2-3))
				
				local a = _G['heads'..i]
				a:sleep(spb*(i-1))
				a:setstate(i-1)
				a:xy( sw/2 + 10*oe, sh/2 - 20 + 56*(i-1) )
				a:tween(spb,'outCubic(%f,0,1,1)')
				a:zoom(.5)
				a:sleep(spb*6)
				a:tween(spb,'inOutExpo(%f,0,1,1)')
				a:x( sw/2 + 10*oe + 160*(mbc3_tier4_winner[i]*2-3))
				
			end
			
		end)
		
		number_change_del = 0
		
		mpf(953,964.999,function(beat,deltatime)
			
			number_change_del = number_change_del-deltatime
			
			if number_change_del < 0 then
				number_change_del = number_change_del+0.05
				
				for pn=1,2 do
					local a = _G['numbersA'..pn]
					a:setstate(math.random(0,5))
				end
				
			end
			
		end)
		
		m2(965,function()
			
			for pn=1,2 do
				local a = _G['numbersA'..pn]
				a:setstate(0)
			end
			
		end)
		
		m2(967,function()
		
			local spb = 60/190
			
			for pn=1,2 do
				local a = _G['numbersA'..pn]
				a:setstate(mbc3_wins[pn])
				a:zoom(1.3)
				a:decelerate(.3)
				a:zoom(1)
				if mbc3_winner == pn then
					a:rainbow()
				end
			end
			
			for i=1,5 do
			
				local oe = (math.mod((i-1),2)+1)*2-3
				
				local a = _G['hexmask'..i]
				a:sleep(spb*4)
				a:tween(spb*2,'inCubic(%f,0,1,1)')
				a:zoom(0)
				
				local a = _G['hexholder'..i]
				a:sleep(spb*4)
				a:tween(spb*2,'inCubic(%f,0,1,1)')
				a:zoom(0)
				
				local a = _G['heads'..i]
				a:sleep(spb*4)
				a:tween(spb*2,'inCubic(%f,0,1,1)')
				a:zoom(0)
				
			end
			
		end)
		
		m2(993,function()
			
			local spb = 60/190
			
			score_container:hidden(0)
			
			for pn=1,2 do
				
				local a = _G['hexmaskA'..pn]
				a:xy( sw/2 + 160*(pn*2-3), sh/2 - 128 )
				a:tween(spb*7,'inCubic(%f,0,1,1)')
				a:zoom(0)
				
				local a = _G['hexholderA'..pn]
				a:xy( sw/2 + 160*(pn*2-3), sh/2 - 128 )
				a:tween(spb*7,'inCubic(%f,0,1,1)')
				a:zoom(0)
				
				local a = _G['numbersA'..pn]
				a:xy( sw/2 + 160*(pn*2-3), sh/2 - 128 )
				a:tween(spb*7,'inCubic(%f,0,1,1)')
				a:zoom(0)
				
				local a = _G['winsA'..pn]
				a:zoom(.8)
				a:xy( sw/2 + 160*(pn*2-3), sh/2 - 128 + 10 )
				a:tween(spb,'linear(%f,0,1,1)')
				a:diffusealpha(0)
				
			end
			
		end)
		]]
		
		
		
		
		
		if table.getn(mod_actions) > 1 then table.sort(mod_actions, modtable_compare) end
		
	end"/>
	
	<Aux Var="finale_auxT_1" />
	<Aux Var="finale_auxT_2" />
	<Aux Var="finale_auxT_3" />
	<Aux Var="finale_auxT_4" />
	<Aux Var="finale_aux" />
	<Aux Var="finale_aux2" />
	
	<Layer File="temple" />
	
	<Layer Type="ActorFrame" Var="finale_prxdc" OnCommand="xy,scx,scy" ><children>
	<Layer Type="ActorFrame" OnCommand="xy,-scx,-scy" InitCommand="%function(self) self:SetDrawByZPosition(true) end" ><children>
	
		<Layer File="../Yin3" Var="char_yin3" />
		<Layer File="hatdrop" Var="yin3_hatdrop" OnCommand="hidden,1" HideCommand="hidden,1" />
		
		<Layer Type="ActorFrame" Var="yin_hat" OnCommand="hidden,1;xy,sw/2,sh/2-130;zoom,0;" ><children>
		<Layer Type="ActorFrame" OnCommand="" ><children>
			<Layer Condition="not uksrt_tournament_mode" File="magic_hat" OnCommand="y,40;cullmode,none;rotationz,10;zoom,18;zoomz,18;spin;effectmagnitude,0,90,0;" />
			<Layer Condition="uksrt_tournament_mode"File="jiang_hat.txt" OnCommand="y,40;cullmode,none;rotationz,10;zoomx,7;zoomy,9;zoomz,7;spin;effectmagnitude,0,90,0;" />
		</children></Layer>
		</children></Layer>
		
		<Layer Type="Quad" Var="yin_finalzbuffer" OnCommand="diffusealpha,0;clearzbuffer,1;diffuse,0,0,0,0;stretchto,0,0,sw,sh" />
		
		<Layer
			File="dimension"
			Var="yin_holepre"
			OnCommand="zoom,0;z,.5;diffusealpha,0;x,sw/2;y,sh*0.7;"
			VortexSpinMessageCommand="hidden,1"
		/>
		
		<Layer Type="ActorFrame"
			FOV="165"
			OnCommand="z,0;x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+60"
			VortexSpinMessageCommand="playcommand,ShowBlackHole"
			PerspectiveMessageCommand="linear,10;rotationx,-20;y,SCREEN_CENTER_Y;zoomx,2;"
			DismissMessageCommand="linear,240/208/2;rotationx,-45;"
			><children>
			<Layer
				File="stars"
				OnCommand="zoom,0;z,100"
				_ShowBlackHoleCommand="linear,9.23;zoom,0.5"
				ShowBlackHoleCommand="zoom,0.5"
			/>
			<Layer
				File="dimension"
				OnCommand="zoom,0;z,20"
				_ShowBlackHoleCommand="linear,9.23;zoom,0.5"
				ShowBlackHoleCommand="zoom,0.5"
			/>
		</children></Layer>
		
		<Layer Var="yin_final_hurt" Type="ActorFrame" OnCommand="fov,60;hidden,1;xy,sw/2,sh/2;basezoomx,.75;basezoomy,.75;" ><children>
		<Layer Type="ActorFrame" OnCommand="fov,60;" DescendCommand="accelerate,2;addy,100;zoomx,0;zoomy,2;" ><children>
			<Layer File="yinhurt" SpinCommand="linear,20;rotationy,360*40;" />
		</children></Layer>
		</children></Layer>
		
		<!--inner objects: aux 0 = no spin, aux 1 = z axis spin, aux 2 = all axes spin -->
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room1/door" OnCommand="aux,2" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room1/noshadow" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,1;basezoomy,1;queuecommand,M" Condition="slumpo" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Tarp/EXBao/private/cool" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room2/plant" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room1/noshadow" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,1;basezoomy,1;queuecommand,M" Condition="slumpo" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Tarp/EXBao/private/uuuuuu" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room2/plant" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,1;basezoomy,1;queuecommand,M" Condition="slumpo" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Tarp/EXBao/private/fascinating" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room2/door" OnCommand="aux,2" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room2/door" OnCommand="aux,2" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room4/chande" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,1;basezoomy,1;queuecommand,M" Condition="slumpo" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Tarp/EXBao/private/joy" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room3/door2" OnCommand="aux,2" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room1/door" OnCommand="aux,2" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room4/chande" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,1;basezoomy,1;queuecommand,M" Condition="slumpo" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Tarp/EXBao/private/taki" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room3/door2" OnCommand="aux,2" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room1/door" OnCommand="aux,2" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,1;basezoomy,1;queuecommand,M" Condition="slumpo" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Tarp/EXBao/private/cool" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room1/noshadow" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room2/plant" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,1;basezoomy,1;queuecommand,M" Condition="slumpo" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Tarp/EXBao/private/yikes" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.5;basezoomy,.5;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="../Doiqui/room1/noshadow" OnCommand="aux,1" /> </children></Layer>
		<Layer Type="ActorFrame" OnCommand="aux,-1;hidden,1;basezoomx,.9;basezoomy,.9;queuecommand,M" HideCommand="hidden,1" MCommand="%yin_add_shit"><children>
		<Layer File="oskari" OnCommand="aux,0" /> </children></Layer>
	
		<Layer Type="ActorProxy" OnCommand="hidden,1;zoom,1;" Var="Proxy1D" GetProxyMessageCommand="%function(self) if P1 then self:SetTarget(P1) end end" />
		<Layer Type="ActorProxy" OnCommand="hidden,1;zoom,1;" Var="Proxy2D" GetProxyMessageCommand="%function(self) if P2 then self:SetTarget(P2) end end" />
		<Layer Type="ActorProxy" OnCommand="hidden,1;zoom,1;" Var="Proxy3D" GetProxyMessageCommand="%function(self) if P3 then self:SetTarget(P3) end end" />
		<Layer Type="ActorProxy" OnCommand="hidden,1;zoom,1;" Var="Proxy4D" GetProxyMessageCommand="%function(self) if P4 then self:SetTarget(P4) end end" />
		
	</children></Layer>
	</children></Layer>
	
	<Layer Type="Quad" Var="yin_temple2bgcover" OnCommand="hidden,1;clearzbuffer,1;diffuse,0,0,0,0;stretchto,0,0,sw,sh" />
	
	<Layer File="light.avi" Var="finale_light" OnCommand="scaletocover,0,0,sw,sh;blend,add;hidden,1;diffusealpha,0;hibernate,322.261;" />
	
	<Layer File="rbeam" OnCommand="vertalign,bottom;rotationz,180;stretchto,0,0,sw,sh;xy,sw/2,sh;hidden,1" HideCommand="hidden,1"
	Text3OnMessageCommand="hidden,0;blend,add;y,sh;linear,.4;y,-sh;queuecommand,Hide;" />
	<Layer File="rbeam" OnCommand="vertalign,bottom;rotationz,180;stretchto,0,0,sw,sh;xy,sw/2,sh;hidden,1" HideCommand="hidden,1"
	Text3OnMessageCommand="hidden,0;blend,add;y,sh;linear,.4;y,-sh;queuecommand,Hide;" />
	
	<Layer Type="Quad" OnCommand="zoomto,sw,180;fadetop,.2;fadebottom,.2;xy,sw/2,sh/2-120;diffuse,0,0,0,0;"
	Text2OnMessageCommand="linear,.4;diffusealpha,.6;sleep,3.6;linear,1;diffusealpha,0;" />
	<Layer File="_eurostile outline" Text="" OnCommand="xy,sw/2,sh/2-120;diffuse,.7,.7,.7,1;shadowlength,0;zoom,.8;cropright,1;"
	Text2OnMessageCommand="settext,What!? Impossible!! How did you-;cropright,1;sleep,.4;diffusealpha,1;linear,3;cropright,0;sleep,0;cropright,1;" />
	
	<Layer Type="Quad" OnCommand="zoomto,sw,180;fadetop,.2;fadebottom,.2;xy,sw/2,sh/2-20;diffuse,0,0,0,0;"
	Text5OnMessageCommand="linear,.4;diffusealpha,.6;sleep,3.6;linear,2;diffusealpha,0;" />
	<Layer File="_eurostile outline" Text="" OnCommand="xy,sw/2,sh/2-20;diffuse,.7,.7,.7,1;shadowlength,0;zoom,.8;cropright,1;"
	Text5OnMessageCommand="%function(self) self:settext('NO!!\n                \nIf I\'m going down, I\'m taking you ALL with me!!') self:queuecommand('Display') end"
	DisplayCommand="cropright,1;sleep,.4;diffusealpha,1;linear,3;cropright,0;sleep,1;linear,2;diffusealpha,0;" />
	
	<Layer Type="Quad" OnCommand="hidden,1"
		StepP1Action1PressMessageCommand="%function(self) if uksrt_tournament_mode and GAMESTATE:GetSongBeat() > 908 and GAMESTATE:GetSongBeat() < 950 then mbc3_forced_winner = 1 end end"
		StepP1Action2PressMessageCommand="%function(self) if uksrt_tournament_mode and GAMESTATE:GetSongBeat() > 908 and GAMESTATE:GetSongBeat() < 950 then mbc3_forced_winner = 2 end end"
		StepP1Action3PressMessageCommand="%function(self) if uksrt_tournament_mode and GAMESTATE:GetSongBeat() > 908 and GAMESTATE:GetSongBeat() < 950 then mbc3_forced_winner = 0 end end"
		StepP1Action8PressMessageCommand="%function(self) if uksrt_tournament_mode or GAMESTATE:IsEditMode() and GAMESTATE:GetSongBeat() < 934 then GAMESTATE:SetSongBeat(934) end end"
	/>
	
	<Layer File="_eurostile outline" Var="debug_victor_text" Text="" OnCommand="xy,sw/2,sh/2-70;zoom,1.6;shadowlength,0;rainbow;" />
	
	<Layer
		Type="ActorFrameTexture"
		InitCommand="%function(self)
			self:SetWidth( dw );
			self:SetHeight( dh );
			self:EnableDepthBuffer( true );
			self:EnableAlphaBuffer( false );
			self:EnableFloat( false );
			self:EnablePreserveTexture( true );        
			self:hidden(1);
			self:Create();
			warp_aft=self
			
		end"
		ShowFinalAFTMessageCommand="hidden,0"
	/>
	
	<Layer Type="Quad" OnCommand="hidden,1;diffuse,0,0,0,1;stretchto,0,0,sw,sh;" ShowFinalAFTMessageCommand="hidden,0" />
	
	<Layer Type="Sprite" Var="warp_aft_sprite" Frag="woah.frag" OnCommand="x,sw/2;y,sh/2;hidden,1;rotationz,0;basezoomy,-1;sleep,.1;queuecommand,RM"
	RMCommand="%function(self) self:SetTexture(warp_aft:GetTexture()) end" ShowFinalAFTMessageCommand="hidden,0" />
	
	<Layer
		Type="ActorFrameTexture"
		InitCommand="%function(self)
			self:SetWidth( dw );
			self:SetHeight( dh );
			self:EnableDepthBuffer( true );
			self:EnableAlphaBuffer( false );
			self:EnableFloat( false );
			self:EnablePreserveTexture( true );        
			self:hidden(1);
			self:Create();
			fuck_you_woahfrag=self
			
		end"
		ShowFinalAFTMessageCommand="hidden,0"
	/>
	
	<Layer Type="Quad" OnCommand="hidden,1;diffuse,0,0,0,1;stretchto,0,0,sw,sh;" ShowFinalAFTMessageCommand="hidden,0" />
	
	<Layer Type="Sprite" Var="final_aft_sprite" OnCommand="x,sw/2;y,sh/2;hidden,1;rotationz,0;basezoomy,-1;sleep,.1;queuecommand,RM"
	RMCommand="%function(self) self:SetTexture(fuck_you_woahfrag:GetTexture()) end" ShowFinalAFTMessageCommand="hidden,0" />
	
	<Layer File="blip" OnCommand="zoom,0;diffusealpha,0;x,sw/2;y,sh*0.55;" FinalBlipMessageCommand="blend,add;linear,.05;zoom,1;diffusealpha,1;linear,.15;zoom,0;" />
	
	<Layer Type="ActorFrame" Var="score_container" OnCommand="hidden,1" ><children>
		
		<Layer Var="hexmask1" File="hexmask" OnCommand="zoom,0;zwrite,1;blend,noeffect;" />
		<Layer Var="hexmask2" File="hexmask" OnCommand="zoom,0;zwrite,1;blend,noeffect;" />
		<Layer Var="hexmask3" File="hexmask" OnCommand="zoom,0;zwrite,1;blend,noeffect;" />
		<Layer Var="hexmask4" File="hexmask" OnCommand="zoom,0;zwrite,1;blend,noeffect;" />
		<Layer Var="hexmask5" File="hexmask" OnCommand="zoom,0;zwrite,1;blend,noeffect;" />
		
		<Layer Var="hexmaskA1" File="hexmask" OnCommand="zoom,0;zwrite,1;blend,noeffect;" />
		<Layer Var="hexmaskA2" File="hexmask" OnCommand="zoom,0;zwrite,1;blend,noeffect;" />
		
		<Layer File="fire" OnCommand="xy,sw/2,sh/2;zoom,4;customtexturerect,0,0,4,4;texcoordvelocity,0,.1;ztestmode,writeonfail;" />
		
		<Layer Var="hexholder1" File="hexholder" OnCommand="zoom,0;" />
		<Layer Var="hexholder2" File="hexholder" OnCommand="zoom,0;" />
		<Layer Var="hexholder3" File="hexholder" OnCommand="zoom,0;" />
		<Layer Var="hexholder4" File="hexholder" OnCommand="zoom,0;" />
		<Layer Var="hexholder5" File="hexholder" OnCommand="zoom,0;" />
		
		<Layer Var="hexholderA1" File="hexholder" OnCommand="zoom,0;" />
		<Layer Var="hexholderA2" File="hexholder" OnCommand="zoom,0;" />
		<Layer Var="winsA1" File="wins" OnCommand="diffusealpha,0;" />
		<Layer Var="winsA2" File="wins" OnCommand="diffusealpha,0;" />
		
		<Layer Var="heads1" File="heads" OnCommand="zoom,0;animate,0;" />
		<Layer Var="heads2" File="heads" OnCommand="zoom,0;animate,0;" />
		<Layer Var="heads3" File="heads" OnCommand="zoom,0;animate,0;" />
		<Layer Var="heads4" File="heads" OnCommand="zoom,0;animate,0;" />
		<Layer Var="heads5" File="heads" OnCommand="zoom,0;animate,0;" />
		
		<Layer Var="numbersA1" File="numbers" OnCommand="zoom,0;animate,0;" />
		<Layer Var="numbersA2" File="numbers" OnCommand="zoom,0;animate,0;" />
		
	</children></Layer>
	
</children></Layer>